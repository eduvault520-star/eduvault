"use strict";(self.webpackChunkeduvault_admin_frontend=self.webpackChunkeduvault_admin_frontend||[]).push([[761],{4761:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ye});var n=s(9950),i=s(6491),a=s(6639),r=s(9808),l=s(3174),o=s(226),c=s(2053),d=s(2236),u=s(4142),x=s(899),h=s(470),m=s(704),A=s(6787),p=s(6163),j=s(8602),v=s(5810),y=s(8517),g=s(4736),f=s(1543),b=s(8),C=s(5277),w=s(5333),S=s(3464),k=s(33),W=s(8170),P=s(9925),I=s(5979),N=s(3788),T=s(6101),E=s(3266),_=s(9739),D=s(3256),U=s(421),z=s(8179),F=s(379),M=s(760),B=s(5926),q=s(2235),R=s(4801),H=s(4320),V=s(9837),O=s(9086),Y=s(6868),L=s(6986),K=s(5546),G=s(249),Q=s(3511),J=s(3563),X=s(1378),Z=s(4745),$=s(5834),ee=s(7898),te=s(3505),se=s(7850),ne=s(975),ie=s(957),ae=s(3779),re=s(8629),le=s(4414);const oe=e=>{let{unit:t,program:s,institution:a,userRole:r,onBack:A}=e;const[p,j]=(0,n.useState)([]),[v,y]=(0,n.useState)(!1),[g,f]=(0,n.useState)(null),[I,N]=(0,n.useState)(0),[T,E]=(0,n.useState)(!1),[U,z]=(0,n.useState)(null),[q,H]=(0,n.useState)({topicNumber:1,title:"",description:"",learningOutcomes:[],content:{lectureVideo:{title:"",filename:"",filePath:"",duration:"",isPremium:!1},notes:{title:"",filename:"",filePath:"",isPremium:!1},youtubeResources:[]}}),[V,O]=(0,n.useState)(!1),[Y,L]=(0,n.useState)(!1),[K,G]=(0,n.useState)(null),[Q,J]=(0,n.useState)(null),[X,Z]=(0,n.useState)(0),[$,se]=(0,n.useState)(0),[oe,ce]=(0,n.useState)(!1),[de,ue]=(0,n.useState)("cats"),[xe,he]=(0,n.useState)(null),[me,Ae]=(0,n.useState)({title:"",description:"",url:"",totalMarks:100,isPremium:!0});(0,n.useEffect)(()=>{t&&j(t.topics||[])},[t]);return(0,le.jsxs)(i.A,{children:[(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,le.jsx)(w.A,{onClick:A,sx:{mr:2},children:(0,le.jsx)(R.A,{})}),(0,le.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,le.jsxs)(c.A,{variant:"h5",color:"primary",sx:{fontWeight:600},children:[t.unitCode," - ",t.unitName]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[s.name," \u2022 ",a.shortName]})]})]}),(0,le.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,le.jsxs)(d.A,{value:I,onChange:(e,t)=>N(t),children:[(0,le.jsx)(u.A,{icon:(0,le.jsx)(te.A,{}),label:"Topics & Content"}),(0,le.jsx)(u.A,{icon:(0,le.jsx)(ee.A,{}),label:"Assessments"})]})}),g&&(0,le.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>f(null),children:g}),0===I&&(0,le.jsxs)(i.A,{children:[(0,le.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,le.jsx)(c.A,{variant:"h6",children:"Topics & Learning Content"}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>{H({topicNumber:p.length+1,title:"",description:"",learningOutcomes:[],content:{lectureVideo:{title:"",url:"",duration:"",isPremium:!1},notes:{title:"",url:"",fileType:"pdf",isPremium:!1}}}),E(!0)},children:"Add Topic"})]}),(0,le.jsx)(x.Ay,{container:!0,spacing:3,children:p.map(e=>{var t,s,n,a,r,l;return(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsx)(h.A,{children:(0,le.jsxs)(m.A,{children:[(0,le.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,le.jsxs)(c.A,{variant:"h6",children:["Topic ",e.topicNumber,": ",e.title]}),(0,le.jsxs)(i.A,{children:[(0,le.jsx)(w.A,{size:"small",onClick:()=>{z(e),H(e),E(!0)},children:(0,le.jsx)(F.A,{})}),(0,le.jsx)(w.A,{size:"small",color:"error",children:(0,le.jsx)(M.A,{})})]})]}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(null===(t=e.content)||void 0===t||null===(s=t.lectureVideo)||void 0===s?void 0:s.filename)&&(0,le.jsx)(C.A,{icon:(0,le.jsx)(ae.A,{}),label:"Video: ".concat(e.content.lectureVideo.status||"pending"),color:"approved"===e.content.lectureVideo.status?"success":"rejected"===e.content.lectureVideo.status?"error":"warning",size:"small"}),(null===(n=e.content)||void 0===n||null===(a=n.notes)||void 0===a?void 0:a.filename)&&(0,le.jsx)(C.A,{icon:(0,le.jsx)(re.A,{}),label:"Notes: ".concat(e.content.notes.status||"pending"),color:"approved"===e.content.notes.status?"success":"rejected"===e.content.notes.status?"error":"warning",size:"small"}),(null===(r=e.content)||void 0===r||null===(l=r.youtubeResources)||void 0===l?void 0:l.length)>0&&(0,le.jsx)(C.A,{icon:(0,le.jsx)(te.A,{}),label:"".concat(e.content.youtubeResources.length," YouTube Links"),color:"info",size:"small"})]})]})})},e._id)})})]}),1===I&&(0,le.jsx)(i.A,{children:(0,le.jsx)(c.A,{variant:"h6",sx:{mb:3},children:"Unit Assessments"})}),(0,le.jsxs)(S.A,{open:T,onClose:()=>E(!1),maxWidth:"md",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:U?"Edit Topic":"Add New Topic"}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Topic Number",type:"number",value:q.topicNumber,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{topicNumber:parseInt(e.target.value)}))})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Topic Title",value:q.title,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{title:e.target.value}))})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:q.description,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{description:e.target.value}))})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Lecture Video Upload"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Video Title",value:q.content.lectureVideo.title,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{content:(0,b.A)((0,b.A)({},t.content),{},{lectureVideo:(0,b.A)((0,b.A)({},t.content.lectureVideo),{},{title:e.target.value})})}))})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Duration (e.g., 45 min)",value:q.content.lectureVideo.duration,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{content:(0,b.A)((0,b.A)({},t.content),{},{lectureVideo:(0,b.A)((0,b.A)({},t.content.lectureVideo),{},{duration:e.target.value})})}))})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsxs)(i.A,{sx:{border:"2px dashed #ccc",borderRadius:2,p:3,textAlign:"center"},children:[(0,le.jsx)("input",{accept:"video/*",style:{display:"none"},id:"video-upload",type:"file",onChange:e=>G(e.target.files[0])}),(0,le.jsx)("label",{htmlFor:"video-upload",children:(0,le.jsx)(o.A,{variant:"outlined",component:"span",startIcon:(0,le.jsx)(te.A,{}),disabled:V,sx:{mb:1},children:V?"Uploading...":"Choose Video File"})}),K&&(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Selected: ",K.name," (",(K.size/1024/1024).toFixed(2)," MB)"]}),(0,le.jsx)(c.A,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Supported formats: MP4, AVI, MOV, WMV (Max: 500MB)"}),(0,le.jsx)(c.A,{variant:"caption",display:"block",color:"warning.main",sx:{mt:1},children:"\u26a0\ufe0f Content will be pending approval by Super Admin"})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"PDF Notes Upload"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Notes Title",value:q.content.notes.title,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{content:(0,b.A)((0,b.A)({},t.content),{},{notes:(0,b.A)((0,b.A)({},t.content.notes),{},{title:e.target.value})})}))})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(ne.A,{control:(0,le.jsx)(ie.A,{checked:q.content.notes.isPremium,onChange:e=>H(t=>(0,b.A)((0,b.A)({},t),{},{content:(0,b.A)((0,b.A)({},t.content),{},{notes:(0,b.A)((0,b.A)({},t.content.notes),{},{isPremium:e.target.checked})})}))}),label:"Premium Content"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsxs)(i.A,{sx:{border:"2px dashed #ccc",borderRadius:2,p:3,textAlign:"center"},children:[(0,le.jsx)("input",{accept:".pdf",style:{display:"none"},id:"notes-upload",type:"file",onChange:e=>J(e.target.files[0])}),(0,le.jsx)("label",{htmlFor:"notes-upload",children:(0,le.jsx)(o.A,{variant:"outlined",component:"span",startIcon:(0,le.jsx)(re.A,{}),disabled:Y,sx:{mb:1},children:Y?"Uploading...":"Choose PDF File"})}),Q&&(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Selected: ",Q.name," (",(Q.size/1024/1024).toFixed(2)," MB)"]}),(0,le.jsx)(c.A,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"PDF files only (Max: 10MB)"}),(0,le.jsx)(c.A,{variant:"caption",display:"block",color:"warning.main",sx:{mt:1},children:"\u26a0\ufe0f Content will be pending approval by Super Admin"})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"YouTube Resources (Optional)"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"YouTube Title",placeholder:"Additional Research Video"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"YouTube URL",placeholder:"https://youtube.com/watch?v=..."})})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:()=>E(!1),children:"Cancel"}),(0,le.jsxs)(o.A,{onClick:async()=>{try{let e=(0,b.A)({},q);if(K){const t=await(async e=>{if(!e)return null;O(!0);const t=new FormData;t.append("file",e);try{console.log("\ud83c\udfa5 Uploading video:",e.name,"Size:",e.size,"Type:",e.type);const s=await B.default.post("/api/upload/video",t,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5,onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);Z(t),console.log("\ud83c\udfa5 Video upload progress: ".concat(t,"%"))}});return console.log("\u2705 Video upload successful:",s.data),s.data.file}catch(g){var s,n,i,a,r,l,o,c,d;console.error("\u274c Video upload error:",g),console.error("Error details:",{message:g.message,status:null===(s=g.response)||void 0===s?void 0:s.status,statusText:null===(n=g.response)||void 0===n?void 0:n.statusText,data:null===(i=g.response)||void 0===i?void 0:i.data,config:{url:null===(a=g.config)||void 0===a?void 0:a.url,method:null===(r=g.config)||void 0===r?void 0:r.method,headers:null===(l=g.config)||void 0===l?void 0:l.headers}});let t="Failed to upload video. ";if("ECONNABORTED"===g.code)t+="Upload timed out. Please try with a smaller file or check your internet connection.";else if("ERR_NETWORK"===g.code||"Network Error"===g.message)t+="Network connection lost during upload. Please check your internet connection and try again.";else if(401===(null===(o=g.response)||void 0===o?void 0:o.status))t+="Please log in again.";else if(413===(null===(c=g.response)||void 0===c?void 0:c.status))t+="File is too large (max 500MB).";else if(400===(null===(d=g.response)||void 0===d?void 0:d.status)){var u,x;t+=(null===(u=g.response)||void 0===u||null===(x=u.data)||void 0===x?void 0:x.message)||"Invalid file format."}else"ECONNREFUSED"===g.code?t+="Server is not running.":t+="Please try again.";return f(t),null}finally{O(!1),Z(0)}})(K);t&&(e.content.lectureVideo=(0,b.A)((0,b.A)({},e.content.lectureVideo),{},{filename:t.filename,filePath:t.filePath,fileSize:t.fileSize,status:"super_admin"===r?"approved":"pending"}))}if(Q){const t=await(async e=>{if(!e)return null;L(!0);const t=new FormData;t.append("file",e);try{console.log("\ud83d\udcc4 Uploading notes:",e.name,"Size:",e.size,"Type:",e.type);const s=await B.default.post("/api/upload/notes",t,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4,onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);se(t),console.log("\ud83d\udcc4 Notes upload progress: ".concat(t,"%"))}});return console.log("\u2705 Notes upload successful:",s.data),s.data.file}catch(g){var s,n,i,a,r,l,o,c,d;console.error("\u274c Notes upload error:",g),console.error("Error details:",{message:g.message,status:null===(s=g.response)||void 0===s?void 0:s.status,statusText:null===(n=g.response)||void 0===n?void 0:n.statusText,data:null===(i=g.response)||void 0===i?void 0:i.data,config:{url:null===(a=g.config)||void 0===a?void 0:a.url,method:null===(r=g.config)||void 0===r?void 0:r.method,headers:null===(l=g.config)||void 0===l?void 0:l.headers}});let t="Failed to upload notes. ";if("ECONNABORTED"===g.code)t+="Upload timed out. Please try with a smaller file or check your internet connection.";else if("ERR_NETWORK"===g.code||"Network Error"===g.message)t+="Network connection lost during upload. Please check your internet connection and try again.";else if(401===(null===(o=g.response)||void 0===o?void 0:o.status))t+="Please log in again.";else if(413===(null===(c=g.response)||void 0===c?void 0:c.status))t+="File is too large (max 10MB).";else if(400===(null===(d=g.response)||void 0===d?void 0:d.status)){var u,x;t+=(null===(u=g.response)||void 0===u||null===(x=u.data)||void 0===x?void 0:x.message)||"Invalid file format (PDF only)."}else"ECONNREFUSED"===g.code?t+="Server is not running.":t+="Please try again.";return f(t),null}finally{L(!1),se(0)}})(Q);t&&(e.content.notes=(0,b.A)((0,b.A)({},e.content.notes),{},{filename:t.filename,filePath:t.filePath,fileSize:t.fileSize,status:"super_admin"===r?"approved":"pending"}))}U?await B.default.put("/api/courses/".concat(s._id,"/units/").concat(t._id,"/topics/").concat(U._id),e):await B.default.post("/api/courses/".concat(s._id,"/units/").concat(t._id,"/topics"),e);const n=(await B.default.get("/api/courses/".concat(s._id))).data.course.units.find(e=>e._id===t._id);j(n.topics||[]),E(!1),z(null),G(null),J(null)}catch(g){console.error("Error saving topic:",g),f("Failed to save topic. Please try again.")}},variant:"contained",children:[U?"Update":"Add"," Topic"]})]})]})]})},ce=e=>{var t,s;let{program:r,institution:d,userRole:u="mini_admin",onBack:h}=e;const[m,A]=(0,n.useState)([]),[v,y]=(0,n.useState)(!0),[f,U]=(0,n.useState)(null),[z,H]=(0,n.useState)(!1),[O,ne]=(0,n.useState)(null),[ie,ae]=(0,n.useState)(null),[re,ce]=(0,n.useState)("units"),[de,ue]=(0,n.useState)(!1),[xe,he]=(0,n.useState)(!1),[me,Ae]=(0,n.useState)(null),[pe,je]=(0,n.useState)({year:1,semester:1,unitCode:"",unitName:"",creditHours:3,description:"",prerequisites:[]}),[ve,ye]=(0,n.useState)({title:"",description:"",totalMarks:30,duration:60,instructions:"",questions:[]}),[ge,fe]=(0,n.useState)({title:"",description:"",totalMarks:100,duration:180,instructions:"",questions:[]});(0,n.useEffect)(()=>{r&&be()},[r]);const be=async()=>{try{y(!0),U(null);const e=await B.default.get("/api/courses/".concat(r._id));A(e.data.course.units||[])}catch(f){console.error("Error fetching units:",f),U("Failed to load units. Please try again."),A(r.units||[])}finally{y(!1)}},Ce=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(ne(e),je({year:e.year||1,semester:e.semester||1,unitCode:e.unitCode||"",unitName:e.unitName||"",creditHours:e.creditHours||3,description:e.description||"",prerequisites:e.prerequisites||[]})):(ne(null),je({year:1,semester:1,unitCode:"",unitName:"",creditHours:3,description:"",prerequisites:[]})),H(!0)},we=()=>{H(!1),ne(null)},Se=(e,t)=>{je(s=>(0,b.A)((0,b.A)({},s),{},{[e]:t}))},ke=()=>{ue(!1),Ae(null)},We=()=>{he(!1),Ae(null)},Pe=(e,t)=>{ye(s=>(0,b.A)((0,b.A)({},s),{},{[e]:t}))},Ie=(e,t)=>{fe(s=>(0,b.A)((0,b.A)({},s),{},{[e]:t}))},Ne=m.reduce((e,t)=>{const s=t.year||1,n=t.semester||1;return e[s]||(e[s]={}),e[s][n]||(e[s][n]=[]),e[s][n].push(t),e},{}),Te=()=>{var e;return Array.from({length:(null===(e=r.duration)||void 0===e?void 0:e.years)||4},(e,t)=>t+1)};return v?(0,le.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,le.jsx)(a.A,{})}):"topics"===re&&ie?(0,le.jsx)(oe,{unit:ie,program:r,institution:d,userRole:u,onBack:()=>{ce("units"),ae(null)}}):(0,le.jsx)(i.A,{children:(0,le.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,le.jsx)(w.A,{onClick:h,sx:{mr:2},children:(0,le.jsx)(R.A,{})}),(0,le.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,le.jsxs)(c.A,{variant:"h5",component:"h2",color:"primary",sx:{fontWeight:600},children:["Unit Management - ",r.name]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[r.code," \u2022 ",d.shortName," \u2022 ",m.length," units"]})]}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>Ce(),sx:{borderRadius:2},children:"Add Unit"})]}),f&&(0,le.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>U(null),children:f}),(0,le.jsx)(q.A,{sx:{p:3,mb:3,bgcolor:"primary.main",color:"white"},children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,le.jsx)(x.Ay,{item:!0,children:(0,le.jsx)(p.A,{sx:{fontSize:40}})}),(0,le.jsxs)(x.Ay,{item:!0,xs:!0,children:[(0,le.jsx)(c.A,{variant:"h6",children:r.name}),(0,le.jsxs)(c.A,{variant:"body2",sx:{opacity:.9},children:[r.level," \u2022 ",null===(t=r.duration)||void 0===t?void 0:t.years," Years \u2022 ",null===(s=r.duration)||void 0===s?void 0:s.semesters," Semesters"]})]}),(0,le.jsx)(x.Ay,{item:!0,children:(0,le.jsxs)(i.A,{textAlign:"center",children:[(0,le.jsx)(c.A,{variant:"h4",children:m.length}),(0,le.jsx)(c.A,{variant:"body2",children:"Total Units"})]})})]})}),Te().map(e=>(0,le.jsxs)(Y.A,{defaultExpanded:1===e,children:[(0,le.jsxs)(L.A,{expandIcon:(0,le.jsx)($.A,{}),children:[(0,le.jsxs)(c.A,{variant:"h6",color:"primary",children:["Year ",e]}),(0,le.jsx)(C.A,{label:"".concat(Object.keys(Ne[e]||{}).reduce((t,s)=>{var n;return t+((null===(n=Ne[e][s])||void 0===n?void 0:n.length)||0)},0)," units"),size:"small",sx:{ml:2}})]}),(0,le.jsx)(K.A,{children:(0,le.jsx)(x.Ay,{container:!0,spacing:2,children:[1,2].map(t=>{var s,a,l,d;return(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsxs)(q.A,{variant:"outlined",sx:{p:2},children:[(0,le.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,le.jsxs)(c.A,{variant:"subtitle1",color:"secondary",sx:{fontWeight:600},children:["Semester ",t]}),(0,le.jsx)(C.A,{label:"".concat((null===(s=Ne[e])||void 0===s||null===(a=s[t])||void 0===a?void 0:a.length)||0," units"),size:"small",color:"secondary"})]}),(null===(l=Ne[e])||void 0===l||null===(d=l[t])||void 0===d?void 0:d.length)>0?(0,le.jsx)(G.A,{dense:!0,children:Ne[e][t].map((s,a)=>{var l,o,d,u,x;return(0,le.jsxs)(n.Fragment,{children:[(0,le.jsxs)(Q.Ay,{children:[(0,le.jsx)(J.A,{primary:(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,le.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:600},children:s.unitCode}),(0,le.jsx)(C.A,{label:"".concat(s.creditHours," CH"),size:"small",color:"info"})]}),secondary:(0,le.jsxs)(i.A,{children:[(0,le.jsx)(c.A,{variant:"body2",children:s.unitName}),s.description&&(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[s.description.substring(0,100),s.description.length>100&&"..."]}),s.prerequisites&&s.prerequisites.length>0&&(0,le.jsxs)(c.A,{variant:"caption",color:"warning.main",display:"block",children:["Prerequisites: ",s.prerequisites.join(", ")]}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,le.jsx)(C.A,{label:"".concat((null===(l=s.assessments)||void 0===l||null===(o=l.cats)||void 0===o?void 0:o.length)||0," CATs"),size:"small",color:"success",variant:"outlined"}),(0,le.jsx)(C.A,{label:"".concat((null===(d=s.assessments)||void 0===d||null===(u=d.pastExams)||void 0===u?void 0:u.length)||0," Exams"),size:"small",color:"warning",variant:"outlined"}),(0,le.jsx)(C.A,{label:"".concat((null===(x=s.topics)||void 0===x?void 0:x.length)||0," Topics"),size:"small",color:"info",variant:"outlined"})]})]})}),(0,le.jsx)(X.A,{children:(0,le.jsxs)(i.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[(0,le.jsx)(w.A,{size:"small",onClick:()=>(e=>{Ae(e),ye({title:"".concat(e.unitCode," - CAT"),description:"Continuous Assessment Test for ".concat(e.unitName),totalMarks:30,duration:60,instructions:"Answer all questions. Show all working clearly.",questions:[]}),ue(!0)})(s),color:"success",title:"Create CAT",sx:{bgcolor:"success.light",color:"white","&:hover":{bgcolor:"success.main"}},children:(0,le.jsx)(j.A,{})}),(0,le.jsx)(w.A,{size:"small",onClick:()=>(e=>{Ae(e),fe({title:"".concat(e.unitCode," - Final Exam"),description:"Final Examination for ".concat(e.unitName),totalMarks:100,duration:180,instructions:"Answer all questions. Show all working clearly.",questions:[]}),he(!0)})(s),color:"warning",title:"Create Exam",sx:{bgcolor:"warning.light",color:"white","&:hover":{bgcolor:"warning.main"}},children:(0,le.jsx)(ee.A,{})}),(0,le.jsx)(w.A,{size:"small",onClick:()=>{ae(s),ce("topics")},color:"secondary",title:"Manage Topics & Content",children:(0,le.jsx)(te.A,{})}),(0,le.jsx)(w.A,{size:"small",onClick:()=>Ce(s),color:"primary",children:(0,le.jsx)(F.A,{})}),(0,le.jsx)(w.A,{size:"small",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this unit? This action cannot be undone."))try{await B.default.delete("/api/courses/".concat(r._id,"/units/").concat(e)),await be()}catch(f){console.error("Error deleting unit:",f),U("Failed to delete unit. Please try again.")}})(s._id),color:"error",children:(0,le.jsx)(M.A,{})})]})})]}),a<Ne[e][t].length-1&&(0,le.jsx)(Z.A,{})]},s._id||a)})}):(0,le.jsxs)(i.A,{sx:{textAlign:"center",py:3},children:[(0,le.jsx)(V.A,{sx:{fontSize:48,color:"text.secondary",mb:1}}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No units added for this semester"}),(0,le.jsx)(o.A,{size:"small",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>{je(s=>(0,b.A)((0,b.A)({},s),{},{year:e,semester:t})),Ce()},sx:{mt:1},children:"Add Unit"})]})]})},t)})})})]},e)),0===m.length&&(0,le.jsxs)(q.A,{sx:{p:4,textAlign:"center"},children:[(0,le.jsx)(V.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,le.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No units found"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Start by adding units for this program. Units are organized by year and semester."}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>Ce(),children:"Add First Unit"})]}),(0,le.jsxs)(S.A,{open:z,onClose:we,maxWidth:"sm",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:O?"Edit Unit":"Add New Unit"}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,children:[(0,le.jsx)(N.A,{children:"Year"}),(0,le.jsx)(T.A,{value:pe.year,onChange:e=>Se("year",e.target.value),label:"Year",children:Te().map(e=>(0,le.jsxs)(E.A,{value:e,children:["Year ",e]},e))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,children:[(0,le.jsx)(N.A,{children:"Semester"}),(0,le.jsxs)(T.A,{value:pe.semester,onChange:e=>Se("semester",e.target.value),label:"Semester",children:[(0,le.jsx)(E.A,{value:1,children:"Semester 1"}),(0,le.jsx)(E.A,{value:2,children:"Semester 2"})]})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Unit Code",value:pe.unitCode,onChange:e=>Se("unitCode",e.target.value.toUpperCase()),required:!0,helperText:"e.g., MATH101, ENG201"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Credit Hours",type:"number",value:pe.creditHours,onChange:e=>Se("creditHours",parseInt(e.target.value)),inputProps:{min:1,max:6},required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Unit Name",value:pe.unitName,onChange:e=>Se("unitName",e.target.value),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:pe.description,onChange:e=>Se("description",e.target.value)})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Prerequisites (comma-separated unit codes)",value:pe.prerequisites.join(", "),onChange:e=>(e=>{const t=e.split(",").map(e=>e.trim()).filter(e=>e);je(e=>(0,b.A)((0,b.A)({},e),{},{prerequisites:t}))})(e.target.value),helperText:"e.g., MATH101, PHYS102"})})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:we,children:"Cancel"}),(0,le.jsx)(o.A,{onClick:async()=>{try{const e=(0,b.A)((0,b.A)({},pe),{},{unitCode:pe.unitCode.toUpperCase()});O?await B.default.put("/api/courses/".concat(r._id,"/units/").concat(O._id),e):await B.default.post("/api/courses/".concat(r._id,"/units"),e),await be(),we()}catch(f){console.error("Error saving unit:",f),U("Failed to save unit. Please try again.")}},variant:"contained",children:O?"Update":"Add Unit"})]})]}),(0,le.jsxs)(S.A,{open:de,onClose:ke,maxWidth:"md",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,le.jsx)(j.A,{color:"success"}),"Create CAT for ",null===me||void 0===me?void 0:me.unitCode]})}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"CAT Title",value:ve.title,onChange:e=>Pe("title",e.target.value),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:2,value:ve.description,onChange:e=>Pe("description",e.target.value)})}),(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Total Marks",type:"number",value:ve.totalMarks,onChange:e=>Pe("totalMarks",parseInt(e.target.value)),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Duration (minutes)",type:"number",value:ve.duration,onChange:e=>Pe("duration",parseInt(e.target.value)),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Instructions",multiline:!0,rows:3,value:ve.instructions,onChange:e=>Pe("instructions",e.target.value),placeholder:"Enter instructions for students..."})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(l.A,{severity:"info",children:"\ud83d\udcdd After creating the CAT, you can add questions and upload files in the assessment management section."})})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:ke,children:"Cancel"}),(0,le.jsx)(o.A,{onClick:async()=>{try{const e=(0,b.A)((0,b.A)({},ve),{},{type:"cat",unitId:me._id,unitCode:me.unitCode,unitName:me.unitName,courseId:r._id,courseName:r.name,institutionId:d._id,institutionName:d.name});await B.default.post("/api/courses/".concat(r._id,"/units/").concat(me._id,"/assessments/cats"),e),await be(),ke(),U(null),alert("CAT created successfully!")}catch(f){console.error("Error creating CAT:",f),U("Failed to create CAT. Please try again.")}},variant:"contained",color:"success",startIcon:(0,le.jsx)(se.A,{}),children:"Create CAT"})]})]}),(0,le.jsxs)(S.A,{open:xe,onClose:We,maxWidth:"md",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,le.jsx)(ee.A,{color:"warning"}),"Create Exam for ",null===me||void 0===me?void 0:me.unitCode]})}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Exam Title",value:ge.title,onChange:e=>Ie("title",e.target.value),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:2,value:ge.description,onChange:e=>Ie("description",e.target.value)})}),(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Total Marks",type:"number",value:ge.totalMarks,onChange:e=>Ie("totalMarks",parseInt(e.target.value)),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Duration (minutes)",type:"number",value:ge.duration,onChange:e=>Ie("duration",parseInt(e.target.value)),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Instructions",multiline:!0,rows:3,value:ge.instructions,onChange:e=>Ie("instructions",e.target.value),placeholder:"Enter instructions for students..."})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(l.A,{severity:"info",children:"\ud83d\udcdd After creating the Exam, you can add questions and upload files in the assessment management section."})})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:We,children:"Cancel"}),(0,le.jsx)(o.A,{onClick:async()=>{try{const e=(0,b.A)((0,b.A)({},ge),{},{type:"exam",unitId:me._id,unitCode:me.unitCode,unitName:me.unitName,courseId:r._id,courseName:r.name,institutionId:d._id,institutionName:d.name});await B.default.post("/api/courses/".concat(r._id,"/units/").concat(me._id,"/assessments/pastExams"),e),await be(),We(),U(null),alert("Exam created successfully!")}catch(f){console.error("Error creating Exam:",f),U("Failed to create Exam. Please try again.")}},variant:"contained",color:"warning",startIcon:(0,le.jsx)(se.A,{}),children:"Create Exam"})]})]})]})})},de=e=>{let{institution:t,userRole:s="mini_admin",onBack:r}=e;const[A,j]=(0,n.useState)([]),[v,y]=(0,n.useState)(!0),[f,U]=(0,n.useState)(null),[z,Y]=(0,n.useState)(!1),[L,K]=(0,n.useState)(null),[G,Q]=(0,n.useState)(null),[J,X]=(0,n.useState)(0),[Z,$]=(0,n.useState)({name:"",code:"",department:"",level:"",duration:{years:1,semesters:2},description:"",entryRequirements:"",careerProspects:[],fees:{local:"",international:"",currency:"KSH"}});(0,n.useEffect)(()=>{t&&ee()},[t]);const ee=async()=>{try{y(!0),U(null);const e=await B.default.get("/api/courses?institution=".concat(t._id));j(e.data.courses||[])}catch(f){console.error("Error fetching programs:",f),U("Failed to load programs. Please try again.")}finally{y(!1)}},te=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var t,s,n,i,a;e?(K(e),$({name:e.name||"",code:e.code||"",department:e.department||"",level:e.level||"",duration:{years:(null===(t=e.duration)||void 0===t?void 0:t.years)||1,semesters:(null===(s=e.duration)||void 0===s?void 0:s.semesters)||2},description:e.description||"",entryRequirements:e.entryRequirements||"",careerProspects:e.careerProspects||[],fees:{local:(null===(n=e.fees)||void 0===n?void 0:n.local)||"",international:(null===(i=e.fees)||void 0===i?void 0:i.international)||"",currency:(null===(a=e.fees)||void 0===a?void 0:a.currency)||"KSH"}})):(K(null),$({name:"",code:"",department:"",level:"",duration:{years:1,semesters:2},description:"",entryRequirements:"",careerProspects:[],fees:{local:"",international:"",currency:"KSH"}}));Y(!0)},se=()=>{Y(!1),K(null)},ne=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(s?n=>(0,b.A)((0,b.A)({},n),{},{[s]:(0,b.A)((0,b.A)({},n[s]),{},{[e]:t})}):s=>(0,b.A)((0,b.A)({},s),{},{[e]:t}))};return v?(0,le.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,le.jsx)(a.A,{})}):(0,le.jsx)(i.A,{children:(0,le.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,le.jsx)(w.A,{onClick:r,sx:{mr:2},children:(0,le.jsx)(R.A,{})}),(0,le.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,le.jsxs)(c.A,{variant:"h5",component:"h2",color:"primary",sx:{fontWeight:600},children:["Programs - ",t.name]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[t.shortName," \u2022 ",A.length," programs"]})]}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>te(),sx:{borderRadius:2},children:"Add Program"})]}),f&&(0,le.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>U(null),children:f}),(0,le.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,le.jsxs)(d.A,{value:J,onChange:(e,t)=>{X(t)},children:[(0,le.jsx)(u.A,{label:"All Programs"}),(0,le.jsx)(u.A,{label:"Unit Management",disabled:!G})]})}),0===J&&(0,le.jsx)(x.Ay,{container:!0,spacing:3,children:0===A.length?(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsxs)(q.A,{sx:{p:4,textAlign:"center"},children:[(0,le.jsx)(p.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,le.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No programs found"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Start by adding the first program for this institution."}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>te(),children:"Add First Program"})]})}):A.map(e=>{var t,n,a,r;return(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,le.jsx)(g.P.div,{whileHover:{scale:1.02},transition:{duration:.2},children:(0,le.jsx)(h.A,{sx:{height:"100%"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h6",sx:{fontWeight:600,mb:1},children:e.name}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.code," \u2022 ",e.department]}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[(0,le.jsx)(C.A,{label:e.level,color:"primary",size:"small"}),(0,le.jsx)(C.A,{icon:(0,le.jsx)(H.A,{}),label:"".concat(null===(t=e.duration)||void 0===t?void 0:t.years," Years"),color:"secondary",size:"small"}),(0,le.jsx)(C.A,{icon:(0,le.jsx)(V.A,{}),label:"".concat(null===(n=e.duration)||void 0===n?void 0:n.semesters," Semesters"),color:"info",size:"small"})]}),(0,le.jsxs)(c.A,{variant:"body2",sx:{mb:2,minHeight:60},children:[null===(a=e.description)||void 0===a?void 0:a.substring(0,120),(null===(r=e.description)||void 0===r?void 0:r.length)>120&&"..."]}),e.careerProspects&&e.careerProspects.length>0&&(0,le.jsxs)(i.A,{sx:{mb:2},children:[(0,le.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Career Prospects:"}),(0,le.jsxs)(c.A,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e.careerProspects.slice(0,2).join(", "),e.careerProspects.length>2&&"..."]})]}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,le.jsx)(o.A,{size:"small",variant:"outlined",startIcon:(0,le.jsx)(O.A,{}),onClick:()=>{Q(e),X(1)},children:"Units"}),(0,le.jsx)(w.A,{size:"small",onClick:()=>te(e),color:"primary",children:(0,le.jsx)(F.A,{})}),"super_admin"===s&&(0,le.jsx)(w.A,{size:"small",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this program? This action cannot be undone."))try{await B.default.delete("/api/courses/".concat(e)),await ee()}catch(f){console.error("Error deleting program:",f),U("Failed to delete program. Please try again.")}})(e._id),color:"error",children:(0,le.jsx)(M.A,{})})]})]})})})},e._id)})}),1===J&&G&&(0,le.jsx)(ce,{program:G,institution:t,userRole:s,onBack:()=>X(0)}),(0,le.jsxs)(S.A,{open:z,onClose:se,maxWidth:"md",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:L?"Edit Program":"Add New Program"}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:8,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Program Name",value:Z.name,onChange:e=>ne("name",e.target.value),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Program Code",value:Z.code,onChange:e=>ne("code",e.target.value.toUpperCase()),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,children:[(0,le.jsx)(N.A,{children:"Department"}),(0,le.jsx)(T.A,{value:Z.department,onChange:e=>ne("department",e.target.value),label:"Department",children:["School of Medicine","School of Engineering","School of Business","School of Education","School of Sciences","School of Arts","School of Nursing","School of Agriculture","School of Law","School of Computing"].map(e=>(0,le.jsx)(E.A,{value:e,children:e},e))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,children:[(0,le.jsx)(N.A,{children:"Level"}),(0,le.jsx)(T.A,{value:Z.level,onChange:e=>ne("level",e.target.value),label:"Level",children:["Certificate","Diploma","Undergraduate","Postgraduate","Masters","PhD"].map(e=>(0,le.jsx)(E.A,{value:e,children:e},e))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Duration (Years)",type:"number",value:Z.duration.years,onChange:e=>ne("years",parseInt(e.target.value),"duration"),inputProps:{min:1,max:6}})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Duration (Semesters)",type:"number",value:Z.duration.semesters,onChange:e=>ne("semesters",parseInt(e.target.value),"duration"),inputProps:{min:2,max:12}})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:Z.description,onChange:e=>ne("description",e.target.value)})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Entry Requirements",multiline:!0,rows:2,value:Z.entryRequirements,onChange:e=>ne("entryRequirements",e.target.value)})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Career Prospects (comma-separated)",value:Z.careerProspects.join(", "),onChange:e=>(e=>{const t=e.split(",").map(e=>e.trim()).filter(e=>e);$(e=>(0,b.A)((0,b.A)({},e),{},{careerProspects:t}))})(e.target.value),helperText:"Enter career prospects separated by commas"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Local Student Fees",type:"number",value:Z.fees.local,onChange:e=>ne("local",e.target.value,"fees")})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"International Student Fees",type:"number",value:Z.fees.international,onChange:e=>ne("international",e.target.value,"fees")})})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:se,children:"Cancel"}),(0,le.jsx)(o.A,{onClick:async()=>{try{const e=(0,b.A)((0,b.A)({},Z),{},{institution:t._id});L?await B.default.put("/api/courses/".concat(L._id),e):await B.default.post("/api/courses",e),await ee(),se()}catch(f){console.error("Error saving program:",f),U("Failed to save program. Please try again.")}},variant:"contained",children:L?"Update":"Create"})]})]})]})})},ue=e=>{let{userRole:t="mini_admin"}=e;const[s,A]=(0,n.useState)([]),[j,v]=(0,n.useState)(!0),[y,f]=(0,n.useState)(null),[q,R]=(0,n.useState)(!1),[H,V]=(0,n.useState)(null),[O,Y]=(0,n.useState)(null),[L,K]=(0,n.useState)(0),[G,Q]=(0,n.useState)({name:"",shortName:"",type:"",location:{town:"",county:"",address:""},contact:{phone:"",email:"",website:""},description:""});(0,n.useEffect)(()=>{J()},[]);const J=async()=>{try{v(!0),f(null);const e=await B.default.get("/api/institutions");A(e.data.institutions||[])}catch(y){console.error("Error fetching institutions:",y),f("Failed to load institutions. Please try again.")}finally{v(!1)}},X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var t,s,n,i,a,r;e?(V(e),Q({name:e.name||"",shortName:e.shortName||"",type:e.type||"",location:{town:(null===(t=e.location)||void 0===t?void 0:t.town)||"",county:(null===(s=e.location)||void 0===s?void 0:s.county)||"",address:(null===(n=e.location)||void 0===n?void 0:n.address)||""},contact:{phone:(null===(i=e.contact)||void 0===i?void 0:i.phone)||"",email:(null===(a=e.contact)||void 0===a?void 0:a.email)||"",website:(null===(r=e.contact)||void 0===r?void 0:r.website)||""},description:e.description||""})):(V(null),Q({name:"",shortName:"",type:"",location:{town:"",county:"",address:""},contact:{phone:"",email:"",website:""},description:""}));R(!0)},Z=()=>{R(!1),V(null)},$=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q(s?n=>(0,b.A)((0,b.A)({},n),{},{[s]:(0,b.A)((0,b.A)({},n[s]),{},{[e]:t})}):s=>(0,b.A)((0,b.A)({},s),{},{[e]:t}))};return j?(0,le.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,le.jsx)(a.A,{})}):(0,le.jsx)(r.A,{maxWidth:"xl",sx:{py:3},children:(0,le.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,le.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,le.jsx)(c.A,{variant:"h4",component:"h1",color:"primary",sx:{fontWeight:600},children:"Institution Management"}),"super_admin"===t&&(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>X(),sx:{borderRadius:2},children:"Add Institution"})]}),y&&(0,le.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>f(null),children:y}),(0,le.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,le.jsxs)(d.A,{value:L,onChange:(e,t)=>{K(t)},children:[(0,le.jsx)(u.A,{label:"All Institutions"}),(0,le.jsx)(u.A,{label:"Program Management",disabled:!O})]})}),0===L&&(0,le.jsx)(x.Ay,{container:!0,spacing:3,children:s.map(e=>{var s,n,a,r,l;return(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,le.jsx)(g.P.div,{whileHover:{scale:1.02},transition:{duration:.2},children:(0,le.jsx)(h.A,{sx:{height:"100%",position:"relative"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,le.jsx)(p.A,{color:"primary",sx:{mr:1}}),(0,le.jsx)(c.A,{variant:"h6",sx:{fontWeight:600},children:e.name})]}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.shortName}),(0,le.jsx)(C.A,{label:null===(s=e.type)||void 0===s?void 0:s.replace("_"," ").toUpperCase(),color:"primary",size:"small",sx:{mb:2}}),(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,le.jsx)(U.A,{fontSize:"small",color:"action",sx:{mr:1}}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[null===(n=e.location)||void 0===n?void 0:n.town,", ",null===(a=e.location)||void 0===a?void 0:a.county]})]}),(0,le.jsxs)(c.A,{variant:"body2",sx:{mb:2,minHeight:40},children:[null===(r=e.description)||void 0===r?void 0:r.substring(0,100),(null===(l=e.description)||void 0===l?void 0:l.length)>100&&"..."]}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,le.jsx)(o.A,{size:"small",variant:"outlined",startIcon:(0,le.jsx)(z.A,{}),onClick:()=>{Y(e),K(1)},children:"Programs"}),"super_admin"===t&&(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(w.A,{size:"small",onClick:()=>X(e),color:"primary",children:(0,le.jsx)(F.A,{})}),(0,le.jsx)(w.A,{size:"small",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this institution? This action cannot be undone."))try{await B.default.delete("/api/institutions/".concat(e)),await J()}catch(y){console.error("Error deleting institution:",y),f("Failed to delete institution. Please try again.")}})(e._id),color:"error",children:(0,le.jsx)(M.A,{})})]})]})]})})})},e._id)})}),1===L&&O&&(0,le.jsx)(de,{institution:O,userRole:t,onBack:()=>K(0)}),(0,le.jsxs)(S.A,{open:q,onClose:Z,maxWidth:"md",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:H?"Edit Institution":"Add New Institution"}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Institution Name",value:G.name,onChange:e=>$("name",e.target.value),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Short Name",value:G.shortName,onChange:e=>$("shortName",e.target.value),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,children:[(0,le.jsx)(N.A,{children:"Institution Type"}),(0,le.jsx)(T.A,{value:G.type,onChange:e=>$("type",e.target.value),label:"Institution Type",children:["public_university","private_university","medical_college","polytechnic","teachers_college","technical_institute"].map(e=>(0,le.jsx)(E.A,{value:e,children:e.replace("_"," ").toUpperCase()},e))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,children:[(0,le.jsx)(N.A,{children:"County"}),(0,le.jsx)(T.A,{value:G.location.county,onChange:e=>$("county",e.target.value,"location"),label:"County",children:["Nairobi","Mombasa","Kisumu","Nakuru","Eldoret","Thika","Malindi","Kitale","Garissa","Kakamega","Machakos","Meru","Nyeri","Kericho","Embu","Migori","Bungoma","Homa Bay","Vihiga","Bomet"].map(e=>(0,le.jsx)(E.A,{value:e,children:e},e))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Town/City",value:G.location.town,onChange:e=>$("town",e.target.value,"location")})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Address",value:G.location.address,onChange:e=>$("address",e.target.value,"location")})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Phone",value:G.contact.phone,onChange:e=>$("phone",e.target.value,"contact")})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Email",type:"email",value:G.contact.email,onChange:e=>$("email",e.target.value,"contact")})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Website",value:G.contact.website,onChange:e=>$("website",e.target.value,"contact")})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:G.description,onChange:e=>$("description",e.target.value)})})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:Z,children:"Cancel"}),(0,le.jsx)(o.A,{onClick:async()=>{try{H?await B.default.put("/api/institutions/".concat(H._id),G):await B.default.post("/api/institutions",G),await J(),Z()}catch(y){console.error("Error saving institution:",y),f("Failed to save institution. Please try again.")}},variant:"contained",children:H?"Update":"Create"})]})]})]})})};var xe=s(4195),he=s(8321),me=s(1227),Ae=s(9885);const pe=()=>{const[e,t]=(0,n.useState)([]),[a,o]=(0,n.useState)(!0),[A,v]=(0,n.useState)(null),[y,f]=(0,n.useState)(0),[b,w]=(0,n.useState)({pending:0,approved:0,rejected:0,total:0});(0,n.useEffect)(()=>{S()},[]);const S=async()=>{try{o(!0);const e=(await Promise.resolve().then(s.bind(s,5926))).default,n=await e.get("/api/admin/content-status");t(n.data.content||[]);const i=(n.data.content||[]).reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e.total++,e),{pending:0,approved:0,rejected:0,total:0});w(i)}catch(A){console.error("Error fetching content status:",A),v("Failed to fetch content status")}finally{o(!1)}},k=e=>{switch(e){case"video":return(0,le.jsx)(te.A,{color:"primary"});case"notes":return(0,le.jsx)(re.A,{color:"secondary"});case"cats":return(0,le.jsx)(j.A,{color:"warning"});case"assignments":return(0,le.jsx)(ee.A,{color:"info"});case"pastExams":return(0,le.jsx)(p.A,{color:"success"});default:return(0,le.jsx)(he.A,{})}},W=e=>{switch(e){case"approved":return"success";case"rejected":return"error";case"pending":return"warning";default:return"default"}},P=e=>{switch(e){case"approved":return(0,le.jsx)(me.A,{color:"success"});case"rejected":return(0,le.jsx)(Ae.A,{color:"error"});case"pending":return(0,le.jsx)(he.A,{color:"warning"});default:return(0,le.jsx)(he.A,{})}},I=e.filter(e=>0===y||(1===y?"pending"===e.status:2===y?"approved"===e.status:3!==y||"rejected"===e.status));return(0,le.jsx)(r.A,{maxWidth:"lg",children:(0,le.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,le.jsxs)(i.A,{sx:{mb:4},children:[(0,le.jsx)(c.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:2},children:"My Content Status"}),(0,le.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Track the approval status of your uploaded content"})]}),(0,le.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{sx:{bgcolor:"warning.light",color:"warning.contrastText"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",sx:{fontWeight:600},children:b.pending}),(0,le.jsx)(c.A,{variant:"body2",children:"Pending Review"})]})})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{sx:{bgcolor:"success.light",color:"success.contrastText"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",sx:{fontWeight:600},children:b.approved}),(0,le.jsx)(c.A,{variant:"body2",children:"Approved"})]})})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{sx:{bgcolor:"error.light",color:"error.contrastText"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",sx:{fontWeight:600},children:b.rejected}),(0,le.jsx)(c.A,{variant:"body2",children:"Rejected"})]})})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{sx:{bgcolor:"info.light",color:"info.contrastText"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",sx:{fontWeight:600},children:b.total}),(0,le.jsx)(c.A,{variant:"body2",children:"Total Uploaded"})]})})})]}),A&&(0,le.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>v(null),children:A}),(0,le.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,le.jsxs)(d.A,{value:y,onChange:(e,t)=>f(t),children:[(0,le.jsx)(u.A,{label:"All (".concat(e.length,")")}),(0,le.jsx)(u.A,{label:"Pending (".concat(b.pending,")")}),(0,le.jsx)(u.A,{label:"Approved (".concat(b.approved,")")}),(0,le.jsx)(u.A,{label:"Rejected (".concat(b.rejected,")")})]})}),(0,le.jsx)(q.A,{children:0===I.length?(0,le.jsxs)(i.A,{sx:{p:4,textAlign:"center"},children:[(0,le.jsx)(he.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,le.jsx)(c.A,{variant:"h6",color:"text.secondary",children:"No content found"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Upload some content to see its approval status here"})]}):(0,le.jsx)(G.A,{children:I.map(e=>(0,le.jsxs)(Q.Ay,{divider:!0,children:[(0,le.jsx)(xe.A,{children:k(e.type)}),(0,le.jsx)(J.A,{primary:(0,le.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,le.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:600},children:e.title}),(0,le.jsx)(C.A,{icon:P(e.status),label:e.status.toUpperCase(),color:W(e.status),size:"small"})]}),secondary:(0,le.jsxs)(i.A,{children:[(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[e.courseName," \u2022 ",e.unitName,e.topicTitle&&" \u2022 ".concat(e.topicTitle)]}),(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Uploaded: ",e.uploadDate.toLocaleDateString(),e.filename&&" \u2022 File: ".concat(e.filename)]}),e.reviewNotes&&(0,le.jsx)(l.A,{severity:"approved"===e.status?"success":"error",sx:{mt:1},children:(0,le.jsxs)(c.A,{variant:"body2",children:[(0,le.jsx)("strong",{children:"Review Notes:"})," ",e.reviewNotes]})})]})})]},e.id))})})]})})};var je=s(3553);const ve=()=>{var e,t,s,r,A,p,y,g,w,U,F,q,R;const{user:H}=(0,f.A)(),[V,O]=(0,n.useState)(!0),[Y,L]=(0,n.useState)(0),[K,G]=(0,n.useState)([]),[Q,J]=(0,n.useState)([]),[X,$]=(0,n.useState)([]),[te,se]=(0,n.useState)([]),[ne,ie]=(0,n.useState)(!1),[ae,re]=(0,n.useState)("cat"),[oe,ce]=(0,n.useState)({title:"",courseId:"",unitId:"",unitName:"",description:"",dueDate:"",totalMarks:"",duration:"",instructions:"",image:null}),[de,ue]=(0,n.useState)(""),[xe,he]=(0,n.useState)(""),[me,Ae]=(0,n.useState)(""),[pe,ve]=(0,n.useState)({open:!1,content:null});(0,n.useEffect)(()=>{ge(),ye()},[]);const ye=async()=>{try{console.log("\ud83d\udcda Fetching assessments from server...");const e=(await B.default.get("/api/admin/assessments")).data.assessments||[];console.log("\ud83d\udccb Fetched assessments:",e);const t=e.filter(e=>"cats"===e.type),s=e.filter(e=>"pastExams"===e.type);G(t),J(s)}catch(de){console.error("Error fetching assessments:",de),ue("Failed to load assessments. Please try again."),G([]),J([])}},ge=async()=>{try{O(!0);const[e]=await Promise.allSettled([B.default.get("/api/courses")]);try{const e=(await B.default.get("/api/admin/my-assessments")).data.assessments||[],t=e.filter(e=>"cats"===e.type||"cat"===e.assessmentType),s=e.filter(e=>"pastExams"===e.type||"exam"===e.assessmentType);G(t),J(s)}catch(de){console.log("No user assessments endpoint, using empty arrays"),G([]),J([])}"fulfilled"===e.status?$(e.value.data.courses||[]):$([{_id:"course1",name:"Computer Science",code:"CS",units:[{_id:"cs101",code:"CS101",unitName:"Computer Science Fundamentals",year:1,semester:1},{_id:"cs102",code:"CS102",unitName:"Programming Fundamentals",year:1,semester:2}]}]),se([])}catch(de){console.error("Error fetching data:",de),ue("Failed to load data. Using sample data.")}finally{O(!1)}},fe=e=>{re(e),ce({title:"",courseId:"",unitId:"",unitName:"",description:"",dueDate:"",totalMarks:"",duration:"",instructions:"",image:null}),Ae(""),ie(!0)},be=()=>{ie(!1),ce({title:"",courseId:"",unitId:"",unitName:"",description:"",dueDate:"",totalMarks:"",duration:"",instructions:"",image:null}),Ae(""),ue("")},Ce=(e,t)=>{if(ce(s=>(0,b.A)((0,b.A)({},s),{},{[e]:t})),"courseId"===e&&(t?(async e=>{try{const t=(await B.default.get("/api/courses/".concat(e))).data.course;t&&t.units?se(t.units):se([])}catch(de){console.error("Error fetching course units:",de);const s=X.find(t=>t._id===e);s&&s.units?se(s.units):se([])}})(t):se([]),ce(e=>(0,b.A)((0,b.A)({},e),{},{unitId:"",unitName:""}))),"unitId"===e){const e=te.find(e=>e._id===t);e&&ce(s=>(0,b.A)((0,b.A)({},s),{},{unitId:t,unitName:e.name}))}},we=e=>{ve({open:!0,content:e})},Se=async(e,t)=>{if(window.confirm("Are you sure you want to delete this ".concat(t,"?")))try{const s="cat"===t?"/api/admin/cats/".concat(e):"/api/admin/exams/".concat(e);await B.default.delete(s),he("".concat(t.toUpperCase()," deleted successfully!")),fetchData(),setTimeout(()=>he(""),3e3)}catch(de){console.error("Error deleting ".concat(t,":"),de),ue("Failed to delete ".concat(t,". Please try again."))}},ke=e=>{switch(e){case"active":return"success";case"scheduled":return"info";case"completed":default:return"default";case"expired":return"error"}},We=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return V?(0,le.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,le.jsx)(a.A,{})}):(0,le.jsxs)(i.A,{sx:{p:3},children:[(0,le.jsxs)(i.A,{sx:{mb:4},children:[(0,le.jsxs)(c.A,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:2},children:["\ud83d\udcdd CATs & Exams Management",(0,le.jsx)(je.A,{color:"error"})]}),(0,le.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Create and manage secure CATs and Exams with image-based questions. All images are protected against screenshots."})]}),de&&(0,le.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>ue(""),children:de}),xe&&(0,le.jsx)(l.A,{severity:"success",sx:{mb:3},onClose:()=>he(""),children:xe}),(0,le.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mb:4},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsxs)(h.A,{variant:"outlined",sx:{p:2,height:"100%"},children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"\ud83d\udccb Create New Assessment"}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:2},children:[(0,le.jsx)(o.A,{variant:"contained",color:"primary",startIcon:(0,le.jsx)(j.A,{}),onClick:()=>fe("cat"),fullWidth:!0,children:"Create CAT"}),(0,le.jsx)(o.A,{variant:"contained",color:"secondary",startIcon:(0,le.jsx)(ee.A,{}),onClick:()=>fe("exam"),fullWidth:!0,children:"Create Exam"})]})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsxs)(h.A,{variant:"outlined",sx:{p:2,height:"100%"},children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,color:"success.main",children:"\ud83d\udcca Quick Stats"}),(0,le.jsxs)(x.Ay,{container:!0,spacing:2,children:[(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsxs)(i.A,{sx:{textAlign:"center"},children:[(0,le.jsx)(c.A,{variant:"h4",color:"primary",children:K.length}),(0,le.jsx)(c.A,{variant:"caption",children:"Active CATs"})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:6,children:(0,le.jsxs)(i.A,{sx:{textAlign:"center"},children:[(0,le.jsx)(c.A,{variant:"h4",color:"secondary",children:Q.length}),(0,le.jsx)(c.A,{variant:"caption",children:"Scheduled Exams"})]})})]})]})})]}),(0,le.jsxs)(h.A,{children:[(0,le.jsxs)(d.A,{value:Y,onChange:(e,t)=>L(t),children:[(0,le.jsx)(u.A,{label:"CATs (".concat(K.length,")"),icon:(0,le.jsx)(j.A,{})}),(0,le.jsx)(u.A,{label:"Exams (".concat(Q.length,")"),icon:(0,le.jsx)(ee.A,{})})]}),(0,le.jsxs)(m.A,{children:[0===Y&&(0,le.jsxs)(i.A,{children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udccb Continuous Assessment Tests (CATs)"}),0===K.length?(0,le.jsxs)(h.A,{variant:"outlined",sx:{p:4,textAlign:"center"},children:[(0,le.jsx)(j.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,le.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No CATs Created Yet"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Create your first CAT to get started with assessments."}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>fe("cat"),children:"Create First CAT"})]}):(0,le.jsx)(x.Ay,{container:!0,spacing:3,children:K.map(e=>(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,le.jsx)(h.A,{variant:"outlined",sx:{height:"100%"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:e.title}),(0,le.jsx)(C.A,{label:e.status.toUpperCase(),color:ke(e.status),size:"small"})]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["\ud83d\udcda ",e.unitName]}),(0,le.jsx)(c.A,{variant:"body2",sx:{mb:2},children:e.description}),(0,le.jsxs)(i.A,{sx:{mb:2},children:[(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["\ud83d\udcc5 Due: ",We(e.dueDate)]}),(0,le.jsx)("br",{}),(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["\ud83d\udcca Marks: ",e.totalMarks," | \u23f1\ufe0f Duration: ",e.duration," min"]})]}),(0,le.jsx)(Z.A,{sx:{my:2}}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,le.jsx)(o.A,{size:"small",variant:"outlined",startIcon:(0,le.jsx)(z.A,{}),onClick:t=>{t.preventDefault(),we(e)},children:"Preview"}),(0,le.jsx)(o.A,{size:"small",variant:"outlined",color:"error",startIcon:(0,le.jsx)(M.A,{}),onClick:()=>Se(e._id,"cat"),children:"Delete"})]})]})})},e._id))})]}),1===Y&&(0,le.jsxs)(i.A,{children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udcdd Final Examinations"}),0===Q.length?(0,le.jsxs)(h.A,{variant:"outlined",sx:{p:4,textAlign:"center"},children:[(0,le.jsx)(ee.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,le.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Exams Scheduled Yet"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Schedule your first exam to begin final assessments."}),(0,le.jsx)(o.A,{variant:"contained",startIcon:(0,le.jsx)(D.A,{}),onClick:()=>fe("exam"),children:"Schedule First Exam"})]}):(0,le.jsx)(x.Ay,{container:!0,spacing:3,children:Q.map(e=>(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,le.jsx)(h.A,{variant:"outlined",sx:{height:"100%"},children:(0,le.jsxs)(m.A,{children:[(0,le.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:e.title}),(0,le.jsx)(C.A,{label:e.status.toUpperCase(),color:ke(e.status),size:"small"})]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["\ud83d\udcda ",e.unitName]}),(0,le.jsx)(c.A,{variant:"body2",sx:{mb:2},children:e.description}),(0,le.jsxs)(i.A,{sx:{mb:2},children:[(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["\ud83d\udcc5 Scheduled: ",We(e.dueDate)]}),(0,le.jsx)("br",{}),(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["\ud83d\udcca Marks: ",e.totalMarks," | \u23f1\ufe0f Duration: ",e.duration," min"]})]}),(0,le.jsx)(Z.A,{sx:{my:2}}),(0,le.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,le.jsx)(o.A,{size:"small",variant:"outlined",startIcon:(0,le.jsx)(z.A,{}),onClick:t=>{t.preventDefault(),we(e)},children:"Preview"}),(0,le.jsx)(o.A,{size:"small",variant:"outlined",color:"error",startIcon:(0,le.jsx)(M.A,{}),onClick:()=>Se(e._id,"exam"),children:"Delete"})]})]})})},e._id))})]})]})]}),(0,le.jsxs)(S.A,{open:ne,onClose:be,maxWidth:"md",fullWidth:!0,children:[(0,le.jsx)(k.A,{children:"cat"===ae?"\ud83d\udccb Create New CAT":"\ud83d\udcdd Schedule New Exam"}),(0,le.jsx)(W.A,{children:(0,le.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mt:1},children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Title",value:oe.title,onChange:e=>Ce("title",e.target.value),placeholder:"Enter ".concat(ae," title"),required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,children:[(0,le.jsx)(N.A,{children:"Course"}),(0,le.jsx)(T.A,{value:oe.courseId,onChange:e=>Ce("courseId",e.target.value),label:"Course",children:X.map(e=>(0,le.jsxs)(E.A,{value:e._id,children:[e.code," - ",e.name]},e._id))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsxs)(I.A,{fullWidth:!0,required:!0,disabled:!oe.courseId,children:[(0,le.jsx)(N.A,{children:"Unit"}),(0,le.jsx)(T.A,{value:oe.unitId,onChange:e=>Ce("unitId",e.target.value),label:"Unit",children:te.map(e=>(0,le.jsxs)(E.A,{value:e._id,children:[e.code," - ",e.unitName||e.name]},e._id))})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Due Date & Time",type:"datetime-local",value:oe.dueDate,onChange:e=>Ce("dueDate",e.target.value),InputLabelProps:{shrink:!0},required:!0})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Total Marks",type:"number",value:oe.totalMarks,onChange:e=>Ce("totalMarks",e.target.value),placeholder:"100"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Duration (minutes)",type:"number",value:oe.duration,onChange:e=>Ce("duration",e.target.value),placeholder:"60"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,le.jsxs)(o.A,{variant:"outlined",component:"label",fullWidth:!0,startIcon:(0,le.jsx)(v.A,{}),sx:{height:"56px"},children:["Upload Image",(0,le.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void ue("Please select a valid image file");if(t.size>5242880)return void ue("Image size must be less than 5MB");ce(e=>(0,b.A)((0,b.A)({},e),{},{image:t}));const e=new FileReader;e.onload=e=>{Ae(e.target.result)},e.readAsDataURL(t),ue("")}}})]})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:oe.description,onChange:e=>Ce("description",e.target.value),placeholder:"Brief description of the assessment"})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,children:(0,le.jsx)(P.A,{fullWidth:!0,label:"Instructions",multiline:!0,rows:3,value:oe.instructions,onChange:e=>Ce("instructions",e.target.value),placeholder:"Special instructions for students"})}),me&&(0,le.jsxs)(x.Ay,{item:!0,xs:12,children:[(0,le.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Image Preview:"}),(0,le.jsx)(i.A,{sx:{border:1,borderColor:"grey.300",borderRadius:1,p:2,textAlign:"center",bgcolor:"grey.50"},children:(0,le.jsx)("img",{src:me,alt:"Preview",style:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}})})]})]})}),(0,le.jsxs)(_.A,{children:[(0,le.jsx)(o.A,{onClick:be,children:"Cancel"}),(0,le.jsxs)(o.A,{onClick:async()=>{try{if(!oe.title||!oe.courseId||!oe.unitId||!oe.dueDate||!oe.image)return void ue("Please fill in all required fields including course, unit, and upload an image");const e=new FormData;e.append("title",oe.title),e.append("courseId",oe.courseId),e.append("unitId",oe.unitId),e.append("unitName",oe.unitName),e.append("description",oe.description),e.append("dueDate",oe.dueDate),e.append("totalMarks",oe.totalMarks),e.append("duration",oe.duration),e.append("instructions",oe.instructions),e.append("assessmentType",ae),e.append("file",oe.image);const t="/api/upload/assessment",s=await B.default.post(t,e,{headers:{"Content-Type":"multipart/form-data"}});console.log("\u2705 Assessment uploaded successfully:",s.data),he("".concat(ae.toUpperCase()," submitted for approval! It will appear to students once approved by Super Admin.")),be(),await ye(),setTimeout(()=>he(""),5e3)}catch(de){console.error("Error creating CAT/Exam:",de),ue("Failed to create ".concat(ae,". Please try again."))}},variant:"contained",disabled:!oe.title||!oe.unitId||!oe.dueDate||!oe.image,children:["Create ",ae.toUpperCase()]})]})]}),(0,le.jsxs)(S.A,{open:pe.open,onClose:()=>ve({open:!1,content:null}),maxWidth:"md",fullWidth:!0,children:[(0,le.jsxs)(k.A,{children:[(null===(e=pe.content)||void 0===e||null===(t=e.assessmentType)||void 0===t?void 0:t.toUpperCase())||(null===(s=pe.content)||void 0===s||null===(r=s.type)||void 0===r?void 0:r.toUpperCase())," Preview: ",null===(A=pe.content)||void 0===A?void 0:A.title]}),(0,le.jsxs)(W.A,{children:[(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",(null===(p=pe.content)||void 0===p?void 0:p.courseName)||"Unknown Course"]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",(null===(y=pe.content)||void 0===y?void 0:y.unitName)||"Unknown Unit"]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Total Marks: ",(null===(g=pe.content)||void 0===g?void 0:g.totalMarks)||"Not specified"]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Duration: ",(null===(w=pe.content)||void 0===w?void 0:w.duration)||"Not specified"," minutes"]}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Status: ",(null===(U=pe.content)||void 0===U?void 0:U.status)||"Pending Approval"]}),(null===(F=pe.content)||void 0===F?void 0:F.description)&&(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(c.A,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Description:"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:pe.content.description})]}),(null===(q=pe.content)||void 0===q?void 0:q.instructions)&&(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(c.A,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Instructions:"}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:pe.content.instructions})]}),(null===(R=pe.content)||void 0===R?void 0:R.filename)&&(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(c.A,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Assessment File:"}),(0,le.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc4 ",pe.content.filename]})]})]}),(0,le.jsx)(_.A,{children:(0,le.jsx)(o.A,{onClick:()=>ve({open:!1,content:null}),children:"Close"})})]})]})},ye=()=>{var e,t,b,C,w,S,k,W,P,I;const[N,T]=(0,n.useState)(null),[E,_]=(0,n.useState)(!0),[D,U]=(0,n.useState)(null),[z,F]=(0,n.useState)(0),{user:M}=(0,f.A)();(0,n.useEffect)(()=>{B()},[]);const B=async()=>{try{_(!0),U(null);const e=(await Promise.resolve().then(s.bind(s,5926))).default,t=await e.get("/api/admin/dashboard");T(t.data)}catch(D){console.error("Error fetching dashboard data:",D),U("Failed to load dashboard data. Please try again.")}finally{_(!1)}};return E?(0,le.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,le.jsx)(a.A,{})}):D?(0,le.jsxs)(r.A,{maxWidth:"lg",sx:{py:4},children:[(0,le.jsx)(l.A,{severity:"error",sx:{mb:2},children:D}),(0,le.jsx)(o.A,{variant:"contained",onClick:B,children:"Retry"})]}):(0,le.jsx)(r.A,{maxWidth:"lg",sx:{mt:{xs:2,md:4},mb:4,px:{xs:1,sm:2}},children:(0,le.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,le.jsx)(c.A,{variant:"h4",gutterBottom:!0,sx:{fontWeight:600,color:"primary.main",fontSize:{xs:"1.5rem",sm:"2rem",md:"2.125rem"}},children:"Mini Admin Dashboard"}),(0,le.jsxs)(c.A,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:["Welcome back, ",null===M||void 0===M?void 0:M.firstName,"! Manage your institution's content and resources."]}),(0,le.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,le.jsxs)(d.A,{value:z,onChange:(e,t)=>{F(t)},variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{minWidth:{xs:"auto",sm:160},fontSize:{xs:"0.75rem",sm:"0.875rem"}}},children:[(0,le.jsx)(u.A,{icon:(0,le.jsx)(A.A,{}),label:"Overview",iconPosition:"start",sx:{flexDirection:{xs:"column",sm:"row"}}}),(0,le.jsx)(u.A,{icon:(0,le.jsx)(p.A,{}),label:"Institutions",iconPosition:"start",sx:{flexDirection:{xs:"column",sm:"row"}}}),(0,le.jsx)(u.A,{icon:(0,le.jsx)(j.A,{}),label:"Assessments",iconPosition:"start",sx:{flexDirection:{xs:"column",sm:"row"}}}),(0,le.jsx)(u.A,{icon:(0,le.jsx)(v.A,{}),label:"Content",iconPosition:"start",sx:{flexDirection:{xs:"column",sm:"row"}}}),(0,le.jsx)(u.A,{icon:(0,le.jsx)(y.A,{}),label:"Reports",iconPosition:"start",sx:{flexDirection:{xs:"column",sm:"row"}}})]})}),0===z&&(0,le.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",color:"primary",children:(null===N||void 0===N||null===(e=N.users)||void 0===e?void 0:e.total)||0}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Total Users"})]})})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",color:"primary",children:(null===N||void 0===N||null===(t=N.resources)||void 0===t?void 0:t.total)||0}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Total Resources"})]})})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",color:"primary",children:(null===N||void 0===N||null===(b=N.users)||void 0===b?void 0:b.activeSubscriptions)||0}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Premium Users"})]})})}),(0,le.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,le.jsx)(h.A,{children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h4",color:"primary",children:((null===N||void 0===N||null===(C=N.assessments)||void 0===C?void 0:C.cats)||0)+((null===N||void 0===N||null===(w=N.assessments)||void 0===w?void 0:w.exams)||0)}),(0,le.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Total Assessments"}),(0,le.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[(null===N||void 0===N||null===(S=N.assessments)||void 0===S?void 0:S.cats)||0," CATs \u2022 ",(null===N||void 0===N||null===(k=N.assessments)||void 0===k?void 0:k.exams)||0," Exams"]})]})})})]}),1===z&&(0,le.jsx)(ue,{userRole:null===M||void 0===M?void 0:M.role}),2===z&&(0,le.jsx)(ve,{}),3===z&&(0,le.jsx)(pe,{}),4===z&&(0,le.jsxs)(i.A,{children:[(0,le.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"Reports & Analytics"}),(0,le.jsx)(x.Ay,{container:!0,spacing:3,children:(0,le.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,le.jsx)(h.A,{children:(0,le.jsxs)(m.A,{children:[(0,le.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"User Analytics"}),(0,le.jsxs)(c.A,{variant:"body2",children:["Total Users: ",(null===N||void 0===N||null===(W=N.users)||void 0===W?void 0:W.total)||0]}),(0,le.jsxs)(c.A,{variant:"body2",children:["Active Students: ",(null===N||void 0===N||null===(P=N.users)||void 0===P?void 0:P.students)||0]}),(0,le.jsxs)(c.A,{variant:"body2",children:["Premium Subscribers: ",(null===N||void 0===N||null===(I=N.users)||void 0===I?void 0:I.activeSubscriptions)||0]})]})})})})]})]})})}}}]);