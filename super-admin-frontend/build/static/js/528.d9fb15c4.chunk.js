"use strict";(self.webpackChunkeduvault_super_admin_frontend=self.webpackChunkeduvault_super_admin_frontend||[]).push([[528],{8528:(e,n,t)=>{t.r(n),t.d(n,{default:()=>ce});var o=t(8),i=t(9950),s=t(9808),a=t(6491),r=t(6639),l=t(2053),c=t(5333),d=t(4447),u=t(2236),x=t(4142),m=t(899),h=t(8089),v=t(704),p=t(226),A=t(1413),j=t(5072),y=t(6387),g=t(9086),b=t(9240),f=t(9238),w=t(6299),C=t(6812),S=t(3553),I=t(9715),k=t(1543),U=t(5926),D=t(3174),R=t(5277),N=t(3464),E=t(33),T=t(8170),L=t(9739),P=t(975),_=t(957),F=t(8785),B=t(3505),W=t(8629),M=t(8517),O=t(8179),H=t(3759),z=t(6835),V=t(760),G=t(6724),K=t(8267),J=t(3935),Y=t(6191),Q=t(5699),q=t(4414);const X=()=>{var e,n,t,c,d,u,x,y,g,b,f,w,C,S,I,k,X,Z,$,ee,ne,te,oe,ie,se,ae,re,le,ce,de,ue,xe,me;const[he,ve]=(0,i.useState)(!0),[pe,Ae]=(0,i.useState)(null),[je,ye]=(0,i.useState)([]),[ge,be]=(0,i.useState)({pending:0,approved:0,rejected:0}),[fe,we]=(0,i.useState)({open:!1,content:null}),[Ce,Se]=(0,i.useState)({open:!1,content:null,action:null}),[Ie,ke]=(0,i.useState)({open:!1,content:null}),[Ue,De]=(0,i.useState)(""),[Re,Ne]=(0,i.useState)(!1),[Ee,Te]=(0,i.useState)({open:!1,message:"",severity:"success"});(0,i.useEffect)(()=>{Le()},[]);const Le=async()=>{try{ve(!0),Ae(null);const e=(await U.A.get("/api/content-approval/pending")).data.pendingContent||[];console.log("\ud83d\udccb Fetched pending content:",e),ye(e),be({pending:e.length,approved:0,rejected:0}),0===e.length&&Ae("No pending content found. All content has been reviewed!")}catch(pe){console.error("Error fetching pending content:",pe),Ae("Failed to fetch pending content. Please check your connection."),ye([]),be({pending:0,approved:0,rejected:0})}finally{ve(!1)}},Pe=e=>{switch(e){case"video":return(0,q.jsx)(B.A,{});case"notes":default:return(0,q.jsx)(W.A,{});case"cats":case"assignments":case"pastExams":return(0,q.jsx)(M.A,{})}},_e=e=>{switch(e){case"video":return"error";case"notes":return"primary";case"cats":case"assignments":case"pastExams":return"warning";default:return"info"}},Fe=(e,n)=>{Se({open:!0,content:e,action:n}),De(""),Ne(!1)},Be=e=>{var n,t;const o=(null===(n=e.content)||void 0===n?void 0:n.filePath)||(null===(t=e.content)||void 0===t?void 0:t.url);o?window.open("".concat("https://eduvault-exms.onrender.com").concat(o),"_blank"):Te({open:!0,message:"File URL not available",severity:"error"})};return he?(0,q.jsxs)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[(0,q.jsx)(r.A,{}),(0,q.jsx)(l.A,{variant:"h6",sx:{ml:2},children:"Loading pending content..."})]}):(0,q.jsxs)(s.A,{maxWidth:"lg",children:[(0,q.jsxs)(a.A,{sx:{mb:4},children:[(0,q.jsx)(l.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:2},children:"\ud83d\udccb Content Approval"}),(0,q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"Review and approve content uploaded by mini admins"})]}),(0,q.jsxs)(m.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,q.jsx)(h.A,{sx:{bgcolor:"warning.main",color:"white"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ge.pending}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u23f3 Pending Review"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,q.jsx)(h.A,{sx:{bgcolor:"success.main",color:"white"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ge.approved}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u2705 Approved"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,q.jsx)(h.A,{sx:{bgcolor:"error.main",color:"white"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ge.rejected}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u274c Rejected"})]})})})]}),pe&&(0,q.jsx)(D.A,{severity:0===je.length?"info":"error",sx:{mb:3},children:pe}),(0,q.jsx)(m.Ay,{container:!0,spacing:3,children:je.map((e,n)=>{var t,o,i,s;return(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{sx:{border:1,borderColor:"divider"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,q.jsx)(A.A,{sx:{bgcolor:"".concat(_e(e.type),".main"),color:"white"},children:Pe(e.type)}),(0,q.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,q.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:e.topicTitle||(null===(t=e.content)||void 0===t?void 0:t.title)||"".concat(e.type.toUpperCase()," Content")}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcda Course: ",e.courseName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcd6 Unit: ",e.unitName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc1 File: ",(null===(o=e.content)||void 0===o?void 0:o.filename)||(null===(i=e.content)||void 0===i?void 0:i.originalName)||"Unknown file"]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udc64 Uploaded by: ",(null===(s=e.content)||void 0===s?void 0:s.uploadedBy)||"Unknown"]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc5 Upload date: ",new Date(e.uploadDate).toLocaleDateString()]})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,q.jsx)(R.A,{label:e.type.toUpperCase(),color:_e(e.type),size:"small"}),(0,q.jsx)(p.A,{size:"small",variant:"outlined",startIcon:(0,q.jsx)(O.A,{}),onClick:()=>(e=>{we({open:!0,content:e})})(e),children:"Preview"}),(0,q.jsx)(p.A,{size:"small",variant:"contained",color:"success",startIcon:(0,q.jsx)(H.A,{}),onClick:()=>Fe(e,"approve"),children:"Approve"}),(0,q.jsx)(p.A,{size:"small",variant:"contained",color:"error",startIcon:(0,q.jsx)(z.A,{}),onClick:()=>Fe(e,"reject"),children:"Reject"}),(0,q.jsx)(p.A,{size:"small",variant:"outlined",color:"error",startIcon:(0,q.jsx)(V.A,{}),onClick:()=>(e=>{ke({open:!0,content:e})})(e),sx:{ml:1},children:"Delete"})]})]})})})},"".concat(e.courseId,"_").concat(e.unitId,"_").concat(e.topicId||e.assessmentId,"_").concat(n))})}),0===je.length&&!he&&(0,q.jsxs)(a.A,{sx:{textAlign:"center",py:8},children:[(0,q.jsx)(l.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"\ud83c\udf89 All caught up!"}),(0,q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"No pending content to review at the moment."}),(0,q.jsx)(p.A,{variant:"outlined",onClick:Le,sx:{mt:2},children:"Refresh"})]}),(0,q.jsxs)(N.A,{open:fe.open,onClose:()=>we({open:!1,content:null}),maxWidth:"md",fullWidth:!0,children:[(0,q.jsxs)(E.A,{children:["Content Preview: ",(null===(e=fe.content)||void 0===e?void 0:e.topicTitle)||(null===(n=fe.content)||void 0===n||null===(t=n.content)||void 0===t?void 0:t.title)]}),(0,q.jsxs)(T.A,{children:[(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Type: ",null===(c=fe.content)||void 0===c||null===(d=c.type)||void 0===d?void 0:d.toUpperCase()]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["File: ",(null===(u=fe.content)||void 0===u||null===(x=u.content)||void 0===x?void 0:x.filename)||(null===(y=fe.content)||void 0===y||null===(g=y.content)||void 0===g?void 0:g.originalName)]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(b=fe.content)||void 0===b?void 0:b.courseName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(f=fe.content)||void 0===f?void 0:f.unitName]}),("cats"===(null===(w=fe.content)||void 0===w?void 0:w.type)||"assignments"===(null===(C=fe.content)||void 0===C?void 0:C.type)||"pastExams"===(null===(S=fe.content)||void 0===S?void 0:S.type))&&(null===(I=fe.content)||void 0===I||null===(k=I.content)||void 0===k?void 0:k.filePath)&&(0,q.jsxs)(a.A,{sx:{mt:3},children:[(0,q.jsx)(l.A,{variant:"subtitle2",sx:{mb:2},children:"\ud83d\udcf8 Assessment Image Preview:"}),(0,q.jsxs)(a.A,{sx:{border:1,borderColor:"divider",borderRadius:1,p:2,textAlign:"center",bgcolor:"grey.50",maxHeight:"400px",overflow:"auto"},children:[(0,q.jsx)("img",{src:"".concat("https://eduvault-exms.onrender.com").concat(fe.content.content.filePath),alt:"Assessment Preview",style:{maxWidth:"100%",maxHeight:"350px",objectFit:"contain",borderRadius:"4px"},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{display:"none",mt:2},children:"\u274c Image preview not available"})]}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"\ud83d\udca1 Check image quality to determine if content should be marked as premium"})]}),(0,q.jsxs)(a.A,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:["video"===(null===(X=fe.content)||void 0===X?void 0:X.type)&&(0,q.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,q.jsx)(G.A,{}),onClick:()=>Be(fe.content),children:"Play Video"}),"notes"===(null===(Z=fe.content)||void 0===Z?void 0:Z.type)&&(0,q.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,q.jsx)(K.A,{}),onClick:()=>Be(fe.content),children:"View PDF"}),("cats"===(null===($=fe.content)||void 0===$?void 0:$.type)||"assignments"===(null===(ee=fe.content)||void 0===ee?void 0:ee.type)||"pastExams"===(null===(ne=fe.content)||void 0===ne?void 0:ne.type))&&(0,q.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,q.jsx)(M.A,{}),onClick:()=>Be(fe.content),children:"View Assessment"}),(0,q.jsx)(p.A,{variant:"outlined",startIcon:(0,q.jsx)(J.A,{}),onClick:()=>(async e=>{try{var n,t,o,i;const s=(null===(n=e.content)||void 0===n?void 0:n.filePath)||(null===(t=e.content)||void 0===t?void 0:t.url);if(!s)throw new Error("File URL not available");const a=await U.A.get("".concat(s),{responseType:"blob"}),r=new Blob([a.data]),l=window.URL.createObjectURL(r),c=document.createElement("a");c.href=l,c.download=(null===(o=e.content)||void 0===o?void 0:o.filename)||(null===(i=e.content)||void 0===i?void 0:i.originalName)||"download",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),Te({open:!0,message:"File downloaded successfully",severity:"success"})}catch(pe){console.error("Download error:",pe),Te({open:!0,message:"Failed to download file",severity:"error"})}})(fe.content),children:"Download File"})]})]}),(0,q.jsxs)(L.A,{children:[(0,q.jsx)(p.A,{variant:"contained",color:"success",startIcon:(0,q.jsx)(H.A,{}),onClick:()=>{we({open:!1,content:null}),Fe(fe.content,"approve")},children:"Approve"}),(0,q.jsx)(p.A,{variant:"contained",color:"error",startIcon:(0,q.jsx)(z.A,{}),onClick:()=>{we({open:!1,content:null}),Fe(fe.content,"reject")},children:"Reject"}),(0,q.jsx)(p.A,{onClick:()=>we({open:!1,content:null}),children:"Close"})]})]}),(0,q.jsxs)(N.A,{open:Ce.open,onClose:()=>Se({open:!1,content:null,action:null}),maxWidth:"sm",fullWidth:!0,children:[(0,q.jsxs)(E.A,{children:["approve"===Ce.action?"Approve":"Reject"," Content"]}),(0,q.jsxs)(T.A,{children:[(0,q.jsxs)(l.A,{variant:"subtitle2",gutterBottom:!0,children:["Content: ",(null===(te=Ce.content)||void 0===te?void 0:te.topicTitle)||(null===(oe=Ce.content)||void 0===oe||null===(ie=oe.content)||void 0===ie?void 0:ie.title)]}),"approve"===Ce.action&&(0,q.jsx)(P.A,{control:(0,q.jsx)(_.A,{checked:Re,onChange:e=>Ne(e.target.checked),color:"warning"}),label:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Y.A,{color:Re?"warning":"disabled"}),(0,q.jsx)(l.A,{children:"Mark as Premium Content"})]}),sx:{mb:2}}),(0,q.jsx)(j.A,{fullWidth:!0,multiline:!0,rows:4,label:"Review Notes",placeholder:"Add notes for ".concat(Ce.action,"ing this content..."),value:Ue,onChange:e=>De(e.target.value),variant:"outlined"})]}),(0,q.jsxs)(L.A,{children:[(0,q.jsx)(p.A,{onClick:()=>Se({open:!1,content:null,action:null}),children:"Cancel"}),(0,q.jsx)(p.A,{variant:"contained",color:"approve"===Ce.action?"success":"error",onClick:async()=>{try{const{content:e,action:n}=Ce,t=(0,o.A)({courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type,reviewNotes:Ue},"approve"===n&&{isPremium:Re}),i="approve"===n?"/api/content-approval/approve":"/api/content-approval/reject";await U.A.post(i,t),ye(n=>n.filter(n=>n.topicId!==e.topicId&&n.assessmentId!==e.assessmentId)),be(e=>(0,o.A)((0,o.A)({},e),{},{pending:Math.max(0,e.pending-1),["approve"===n?"approved":"rejected"]:e["approve"===n?"approved":"rejected"]+1})),Te({open:!0,message:"Content ".concat(n,"d successfully! ").concat(Re&&"approve"===n?"\u2b50 Marked as Premium":""),severity:"success"}),Se({open:!1,content:null,action:null})}catch(pe){var e,n;console.error("Error submitting review:",pe),Te({open:!0,message:"Failed to ".concat(Ce.action," content: ").concat((null===(e=pe.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||pe.message),severity:"error"})}},startIcon:"approve"===Ce.action?(0,q.jsx)(H.A,{}):(0,q.jsx)(z.A,{}),children:"approve"===Ce.action?"Approve":"Reject"})]})]}),(0,q.jsxs)(N.A,{open:Ie.open,onClose:()=>ke({open:!1,content:null}),maxWidth:"sm",fullWidth:!0,children:[(0,q.jsxs)(E.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Q.A,{color:"error"}),"Delete Content Permanently"]}),(0,q.jsxs)(T.A,{children:[(0,q.jsx)(l.A,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to permanently delete this content from the database?"}),(0,q.jsxs)(l.A,{variant:"subtitle2",color:"error",gutterBottom:!0,children:["Content: ",(null===(se=Ie.content)||void 0===se?void 0:se.topicTitle)||(null===(ae=Ie.content)||void 0===ae||null===(re=ae.content)||void 0===re?void 0:re.title)]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(le=Ie.content)||void 0===le?void 0:le.courseName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(ce=Ie.content)||void 0===ce?void 0:ce.unitName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["File: ",(null===(de=Ie.content)||void 0===de||null===(ue=de.content)||void 0===ue?void 0:ue.filename)||(null===(xe=Ie.content)||void 0===xe||null===(me=xe.content)||void 0===me?void 0:me.originalName)]}),(0,q.jsx)(D.A,{severity:"error",sx:{mt:2},children:"\u26a0\ufe0f This action cannot be undone! The content will be permanently removed from the database."})]}),(0,q.jsxs)(L.A,{children:[(0,q.jsx)(p.A,{onClick:()=>ke({open:!1,content:null}),children:"Cancel"}),(0,q.jsx)(p.A,{variant:"contained",color:"error",onClick:async()=>{try{const e=Ie.content;await U.A.delete("/api/content-approval/delete",{data:{courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type}}),ye(n=>n.filter(n=>n.topicId!==e.topicId&&n.assessmentId!==e.assessmentId)),be(e=>(0,o.A)((0,o.A)({},e),{},{pending:Math.max(0,e.pending-1)})),Te({open:!0,message:"Content deleted successfully from database",severity:"success"}),ke({open:!1,content:null})}catch(pe){var e,n;console.error("Error deleting content:",pe),Te({open:!0,message:"Failed to delete content: ".concat((null===(e=pe.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||pe.message),severity:"error"})}},startIcon:(0,q.jsx)(V.A,{}),children:"Delete Permanently"})]})]}),(0,q.jsx)(F.A,{open:Ee.open,autoHideDuration:6e3,onClose:()=>Te((0,o.A)((0,o.A)({},Ee),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,q.jsx)(D.A,{onClose:()=>Te((0,o.A)((0,o.A)({},Ee),{},{open:!1})),severity:Ee.severity,sx:{width:"100%"},children:Ee.message})})]})};var Z=t(7239),$=t(3266),ee=t(4745),ne=t(6281),te=t(9489),oe=t(379);const ie=()=>{var e,n,t,d,u,x,j,y,g,b,f,w,C,S,I,k,P,_,H,z;const[X,ie]=(0,i.useState)(!0),[se,ae]=(0,i.useState)(null),[re,le]=(0,i.useState)([]),[ce,de]=(0,i.useState)({approved:0,premium:0,total:0}),[ue,xe]=(0,i.useState)({open:!1,content:null}),[me,he]=(0,i.useState)({open:!1,content:null}),[ve,pe]=(0,i.useState)({open:!1,content:null}),[Ae,je]=(0,i.useState)(null),[ye,ge]=(0,i.useState)(null),[be,fe]=(0,i.useState)({open:!1,message:"",severity:"success"});(0,i.useEffect)(()=>{we()},[]);const we=async()=>{try{ie(!0),ae(null);const e=(await U.A.get("/api/content-approval/approved")).data.approvedContent||[];console.log("\ud83d\udccb Fetched approved content:",e),le(e);const n=e.filter(e=>{var n;return null===(n=e.content)||void 0===n?void 0:n.isPremium}).length;de({approved:e.length,premium:n,total:e.length}),0===e.length&&ae("No approved content found.")}catch(se){console.error("Error fetching approved content:",se),ae("Failed to fetch approved content. Please check your connection."),le([]),de({approved:0,premium:0,total:0})}finally{ie(!1)}},Ce=e=>{switch(e){case"video":return(0,q.jsx)(B.A,{});case"notes":default:return(0,q.jsx)(W.A,{});case"cats":case"assignments":case"pastExams":return(0,q.jsx)(M.A,{})}},Se=e=>{switch(e){case"video":return"error";case"notes":return"primary";case"cats":case"assignments":case"pastExams":return"warning";default:return"info"}},Ie=()=>{je(null),ge(null)};return X?(0,q.jsxs)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[(0,q.jsx)(r.A,{}),(0,q.jsx)(l.A,{variant:"h6",sx:{ml:2},children:"Loading approved content..."})]}):(0,q.jsxs)(s.A,{maxWidth:"lg",children:[(0,q.jsxs)(a.A,{sx:{mb:4},children:[(0,q.jsx)(l.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:2},children:"\ud83d\udcda Approved Content Management"}),(0,q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"View, edit, and manage all approved educational content"})]}),(0,q.jsxs)(m.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,q.jsx)(h.A,{sx:{bgcolor:"success.main",color:"white"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ce.approved}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u2705 Approved Content"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,q.jsx)(h.A,{sx:{bgcolor:"warning.main",color:"white"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ce.premium}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u2b50 Premium Content"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,q.jsx)(h.A,{sx:{bgcolor:"info.main",color:"white"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ce.total}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\ud83d\udcca Total Content"})]})})})]}),se&&(0,q.jsx)(D.A,{severity:0===re.length?"info":"error",sx:{mb:3},children:se}),(0,q.jsx)(m.Ay,{container:!0,spacing:3,children:re.map((e,n)=>{var t,o,i,s,r;return(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{sx:{border:1,borderColor:"divider"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,q.jsx)(A.A,{sx:{bgcolor:"".concat(Se(e.type),".main"),color:"white"},children:Ce(e.type)}),(0,q.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,q.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:e.topicTitle||(null===(t=e.content)||void 0===t?void 0:t.title)||"".concat(e.type.toUpperCase()," Content")}),(null===(o=e.content)||void 0===o?void 0:o.isPremium)&&(0,q.jsx)(Y.A,{color:"warning",sx:{fontSize:20}})]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcda Course: ",e.courseName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcd6 Unit: ",e.unitName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc1 File: ",(null===(i=e.content)||void 0===i?void 0:i.filename)||(null===(s=e.content)||void 0===s?void 0:s.originalName)||"Unknown file"]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc5 Approved: ",new Date((null===(r=e.content)||void 0===r?void 0:r.reviewDate)||e.uploadDate).toLocaleDateString()]})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,q.jsx)(R.A,{label:e.type.toUpperCase(),color:Se(e.type),size:"small"}),(0,q.jsx)(c.A,{onClick:n=>((e,n)=>{je(e.currentTarget),ge(n)})(n,e),size:"small",children:(0,q.jsx)(ne.A,{})})]})]})})})},"".concat(e.courseId,"_").concat(e.unitId,"_").concat(e.topicId||e.assessmentId,"_").concat(n))})}),0===re.length&&!X&&(0,q.jsxs)(a.A,{sx:{textAlign:"center",py:8},children:[(0,q.jsx)(l.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"\ud83d\udced No approved content found"}),(0,q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"Content will appear here once it has been approved."}),(0,q.jsx)(p.A,{variant:"outlined",onClick:we,sx:{mt:2},children:"Refresh"})]}),(0,q.jsxs)(Z.A,{anchorEl:Ae,open:Boolean(Ae),onClose:Ie,children:[(0,q.jsxs)($.A,{onClick:()=>(xe({open:!0,content:ye}),void Ie()),children:[(0,q.jsx)(O.A,{sx:{mr:1}}),"Preview"]}),(0,q.jsxs)($.A,{onClick:()=>(e=>{var n,t;const o=(null===(n=e.content)||void 0===n?void 0:n.filePath)||(null===(t=e.content)||void 0===t?void 0:t.url);o?window.open("".concat("https://eduvault-exms.onrender.com").concat(o),"_blank"):fe({open:!0,message:"File URL not available",severity:"error"})})(ye),children:["video"===(null===ye||void 0===ye?void 0:ye.type)&&(0,q.jsx)(G.A,{sx:{mr:1}}),"notes"===(null===ye||void 0===ye?void 0:ye.type)&&(0,q.jsx)(K.A,{sx:{mr:1}}),("cats"===(null===ye||void 0===ye?void 0:ye.type)||"assignments"===(null===ye||void 0===ye?void 0:ye.type)||"pastExams"===(null===ye||void 0===ye?void 0:ye.type))&&(0,q.jsx)(M.A,{sx:{mr:1}}),"View File"]}),(0,q.jsxs)($.A,{onClick:()=>(async e=>{try{var n,t,o,i;const s=(null===(n=e.content)||void 0===n?void 0:n.filePath)||(null===(t=e.content)||void 0===t?void 0:t.url);if(!s)throw new Error("File URL not available");const a=await U.A.get("".concat(s),{responseType:"blob"}),r=new Blob([a.data]),l=window.URL.createObjectURL(r),c=document.createElement("a");c.href=l,c.download=(null===(o=e.content)||void 0===o?void 0:o.filename)||(null===(i=e.content)||void 0===i?void 0:i.originalName)||"download",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),fe({open:!0,message:"File downloaded successfully",severity:"success"})}catch(se){console.error("Download error:",se),fe({open:!0,message:"Failed to download file",severity:"error"})}})(ye),children:[(0,q.jsx)(J.A,{sx:{mr:1}}),"Download"]}),(0,q.jsx)(ee.A,{}),(0,q.jsxs)($.A,{onClick:()=>(async e=>{try{var n;const t=!(null!==(n=e.content)&&void 0!==n&&n.isPremium);await U.A.put("/api/content-approval/premium",{courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type,isPremium:t}),le(n=>n.map(n=>n.topicId===e.topicId||n.assessmentId===e.assessmentId?(0,o.A)((0,o.A)({},n),{},{content:(0,o.A)((0,o.A)({},n.content),{},{isPremium:t})}):n)),de(e=>(0,o.A)((0,o.A)({},e),{},{premium:t?e.premium+1:e.premium-1})),fe({open:!0,message:"Content ".concat(t?"marked as premium":"removed from premium"),severity:"success"})}catch(se){console.error("Error updating premium status:",se),fe({open:!0,message:"Failed to update premium status",severity:"error"})}})(ye),children:[null!==ye&&void 0!==ye&&null!==(e=ye.content)&&void 0!==e&&e.isPremium?(0,q.jsx)(te.A,{sx:{mr:1}}):(0,q.jsx)(Y.A,{sx:{mr:1}}),null!==ye&&void 0!==ye&&null!==(n=ye.content)&&void 0!==n&&n.isPremium?"Remove Premium":"Mark Premium"]}),(0,q.jsxs)($.A,{onClick:()=>(he({open:!0,content:ye}),void Ie()),children:[(0,q.jsx)(oe.A,{sx:{mr:1}}),"Edit"]}),(0,q.jsxs)($.A,{onClick:()=>(pe({open:!0,content:ye}),void Ie()),sx:{color:"error.main"},children:[(0,q.jsx)(V.A,{sx:{mr:1}}),"Delete"]})]}),(0,q.jsxs)(N.A,{open:ue.open,onClose:()=>xe({open:!1,content:null}),maxWidth:"md",fullWidth:!0,children:[(0,q.jsxs)(E.A,{children:["Content Preview: ",(null===(t=ue.content)||void 0===t?void 0:t.topicTitle)||(null===(d=ue.content)||void 0===d||null===(u=d.content)||void 0===u?void 0:u.title)]}),(0,q.jsxs)(T.A,{children:[(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Type: ",null===(x=ue.content)||void 0===x||null===(j=x.type)||void 0===j?void 0:j.toUpperCase()]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["File: ",(null===(y=ue.content)||void 0===y||null===(g=y.content)||void 0===g?void 0:g.filename)||(null===(b=ue.content)||void 0===b||null===(f=b.content)||void 0===f?void 0:f.originalName)]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(w=ue.content)||void 0===w?void 0:w.courseName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(C=ue.content)||void 0===C?void 0:C.unitName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Status: ",null!==(S=ue.content)&&void 0!==S&&null!==(I=S.content)&&void 0!==I&&I.isPremium?"\u2b50 Premium":"\ud83c\udd93 Free"]})]}),(0,q.jsx)(L.A,{children:(0,q.jsx)(p.A,{onClick:()=>xe({open:!1,content:null}),children:"Close"})})]}),(0,q.jsxs)(N.A,{open:ve.open,onClose:()=>pe({open:!1,content:null}),maxWidth:"sm",fullWidth:!0,children:[(0,q.jsxs)(E.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Q.A,{color:"error"}),"Delete Approved Content"]}),(0,q.jsxs)(T.A,{children:[(0,q.jsx)(l.A,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to permanently delete this approved content from the database?"}),(0,q.jsxs)(l.A,{variant:"subtitle2",color:"error",gutterBottom:!0,children:["Content: ",(null===(k=ve.content)||void 0===k?void 0:k.topicTitle)||(null===(P=ve.content)||void 0===P||null===(_=P.content)||void 0===_?void 0:_.title)]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(H=ve.content)||void 0===H?void 0:H.courseName]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(z=ve.content)||void 0===z?void 0:z.unitName]}),(0,q.jsx)(D.A,{severity:"error",sx:{mt:2},children:"\u26a0\ufe0f This action cannot be undone! The content will be permanently removed from the database."})]}),(0,q.jsxs)(L.A,{children:[(0,q.jsx)(p.A,{onClick:()=>pe({open:!1,content:null}),children:"Cancel"}),(0,q.jsx)(p.A,{variant:"contained",color:"error",onClick:async()=>{try{const e=ve.content;await U.A.delete("/api/content-approval/delete",{data:{courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type}}),le(n=>n.filter(n=>n.topicId!==e.topicId&&n.assessmentId!==e.assessmentId)),de(n=>{var t;return(0,o.A)((0,o.A)({},n),{},{approved:Math.max(0,n.approved-1),premium:null!==(t=e.content)&&void 0!==t&&t.isPremium?Math.max(0,n.premium-1):n.premium,total:Math.max(0,n.total-1)})}),fe({open:!0,message:"Content deleted successfully from database",severity:"success"}),pe({open:!1,content:null})}catch(se){var e,n;console.error("Error deleting content:",se),fe({open:!0,message:"Failed to delete content: ".concat((null===(e=se.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||se.message),severity:"error"})}},startIcon:(0,q.jsx)(V.A,{}),children:"Delete Permanently"})]})]}),(0,q.jsx)(F.A,{open:be.open,autoHideDuration:6e3,onClose:()=>fe((0,o.A)((0,o.A)({},be),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,q.jsx)(D.A,{onClose:()=>fe((0,o.A)((0,o.A)({},be),{},{open:!1})),severity:be.severity,sx:{width:"100%"},children:be.message})})]})};var se=t(2046),ae=t(4801);const re=e=>{var n,t;let{institution:o,onBack:c}=e;const[d,u]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{o&&u(!1)},[o]),d?(0,q.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,q.jsx)(r.A,{})}):(0,q.jsxs)(s.A,{maxWidth:"lg",children:[(0,q.jsx)(a.A,{sx:{mb:4},children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsx)(l.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:1},children:o.name}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[null===(n=o.location)||void 0===n?void 0:n.town,", ",null===(t=o.location)||void 0===t?void 0:t.county]})]}),(0,q.jsx)(p.A,{variant:"outlined",startIcon:(0,q.jsx)(ae.A,{}),onClick:c,children:"Back to Institutions"})]})}),(0,q.jsx)(l.A,{variant:"h5",sx:{fontWeight:600,mb:3},children:"Institution Details - Minimal View"}),(0,q.jsxs)(a.A,{sx:{p:4,textAlign:"center",border:1,borderColor:"divider",borderRadius:2},children:[(0,q.jsx)(l.A,{variant:"h6",color:"text.secondary",children:"This is a minimal version to test component loading"}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"If this loads successfully, we can identify which component was causing the issue"})]})]})},le=e=>{let{userRole:n}=e;const[t,o]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[u,x]=(0,i.useState)(""),[A,y]=(0,i.useState)(null),[g,b]=(0,i.useState)(!1),[f,w]=(0,i.useState)(""),[C,S]=(0,i.useState)(""),[k,R]=(0,i.useState)(!1),[N,E]=(0,i.useState)(null);(0,i.useEffect)(()=>{T()},[]);const T=async()=>{try{d(!0);const e=await U.A.get("/api/institutions");o(e.data.institutions||[])}catch(C){console.error("Error fetching institutions:",C),S("Failed to fetch institutions. Displaying mock data."),o([{_id:"1",name:"University of Nairobi",shortName:"UoN",type:"University",location:{town:"Nairobi",county:"Nairobi"},description:"Premier university in Kenya.",established:"1970",programs:45,students:84e3},{_id:"2",name:"Kenyatta University",shortName:"KU",type:"University",location:{town:"Kahawa",county:"Kiambu"},description:"Public university known for education.",established:"1985",programs:38,students:7e4}])}finally{d(!1)}},L=()=>{R(!1),E(null)},P=t.filter(e=>{var n,t,o,i;return((null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||"").includes(u.toLowerCase())||((null===(t=e.type)||void 0===t?void 0:t.toLowerCase())||"").includes(u.toLowerCase())||((null===(o=e.location)||void 0===o||null===(i=o.county)||void 0===i?void 0:i.toLowerCase())||"").includes(u.toLowerCase())});return c?(0,q.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,q.jsx)(r.A,{})}):k&&N?(0,q.jsx)(re,{institution:N,onBack:L}):(0,q.jsxs)(s.A,{maxWidth:"xl",children:[(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,q.jsx)(l.A,{variant:"h5",fontWeight:"bold",children:"Institution Management"}),"super_admin"===n&&(0,q.jsx)(p.A,{variant:"contained",color:"primary",onClick:()=>{y(null),b(!0)},children:"Add Institution"})]}),C&&(0,q.jsx)(D.A,{severity:"error",sx:{mb:2},children:C}),f&&(0,q.jsx)(D.A,{severity:"success",sx:{mb:2},children:f}),(0,q.jsx)(j.A,{fullWidth:!0,placeholder:"Search institutions by name, type, or county...",value:u,onChange:e=>x(e.target.value),sx:{mb:3},InputProps:{startAdornment:(0,q.jsx)(se.A,{position:"start",children:(0,q.jsx)(I.A,{})})}}),(0,q.jsx)(m.Ay,{container:!0,spacing:3,children:P.map(e=>{var i,s;return(0,q.jsx)(m.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,q.jsxs)(h.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,q.jsxs)(v.A,{sx:{flexGrow:1},children:[(0,q.jsx)(l.A,{variant:"h6",component:"h3",gutterBottom:!0,children:e.name}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.type}),(0,q.jsxs)(l.A,{variant:"body2",sx:{mb:2},children:["\ud83d\udccd ",null===(i=e.location)||void 0===i?void 0:i.town,", ",null===(s=e.location)||void 0===s?void 0:s.county]})]}),(0,q.jsxs)(a.A,{sx:{p:2,pt:0},children:[(0,q.jsx)(p.A,{size:"small",variant:"contained",color:"primary",onClick:()=>(e=>{E(e),R(!0)})(e),sx:{mr:1},children:"View Details"}),"super_admin"===n&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(p.A,{size:"small",onClick:()=>(e=>{y(e),b(!0)})(e),sx:{mr:1},children:"Edit"}),(0,q.jsx)(p.A,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this institution?"))try{await U.A.delete("/api/institutions/".concat(e)),o(t.filter(n=>n._id!==e)),w("Institution deleted successfully"),setTimeout(()=>w(""),3e3)}catch(C){S("Failed to delete institution"),setTimeout(()=>S(""),3e3)}})(e._id),children:"Delete"})]})]})]})},e._id)})}),0===P.length&&!c&&(0,q.jsx)(a.A,{sx:{textAlign:"center",py:4},children:(0,q.jsx)(l.A,{variant:"h6",color:"text.secondary",children:"No institutions found matching your search criteria"})})]})},ce=()=>{var e,n,t,D,R,N,E,T,L,P,_,F,B,W,M,O,H,z,V,G,K,J,Y,Q,Z,$,ee,ne,te,oe,se,ae,re,ce,de,ue,xe,me,he,ve,pe,Ae,je,ye,ge,be,fe,we,Ce;const[Se,Ie]=(0,i.useState)(null),[ke,Ue]=(0,i.useState)(!0),[De,Re]=(0,i.useState)(0),[Ne,Ee]=(0,i.useState)([]),[Te,Le]=(0,i.useState)(""),[Pe,_e]=(0,i.useState)("all"),[Fe,Be]=(0,i.useState)("all"),{user:We}=(0,k.A)();(0,i.useEffect)(()=>{Me()},[]),(0,i.useEffect)(()=>{const e=e=>{const{tabId:n}=e.detail,t={institutions:1,"content-approval":2,"user-management":3,financial:4,"system-health":5};void 0!==t[n]&&Re(t[n])};return window.addEventListener("superAdminTabChange",e),()=>window.removeEventListener("superAdminTabChange",e)},[]);const Me=async()=>{try{Ue(!0);const[e,n,t,o]=await Promise.allSettled([U.A.get("/api/admin/users"),U.A.get("/api/admin/payments"),U.A.get("/api/institutions"),U.A.get("/api/content-approval/pending")]),i={connectionStatus:"online",dataSource:{users:"database",payments:"database",institutions:"database",content:"database"}};if("fulfilled"===e.status){const n=e.value.data.users||[];Ee(n),i.totalUsers=n.length,i.activeUsers=n.filter(e=>e.isActive).length,i.newUsersThisMonth=n.filter(e=>{const n=new Date(e.createdAt),t=new Date;return n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear()}).length}else console.error("Failed to fetch users:",e.reason),i.dataSource.users="cache",i.totalUsers=0,i.activeUsers=0,i.newUsersThisMonth=0,Ee([]);if("fulfilled"===n.status){const e=n.value.data.payments||[],t=e.reduce((e,n)=>e+(n.amount||0),0);i.totalRevenue=t,i.totalPayments=e.length,i.revenueThisMonth=e.filter(e=>{const n=new Date(e.createdAt),t=new Date;return n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear()}).reduce((e,n)=>e+(n.amount||0),0)}else console.error("Failed to fetch payments:",n.reason),i.dataSource.payments="cache",i.totalRevenue=0,i.totalPayments=0,i.revenueThisMonth=0;if("fulfilled"===t.status){const e=t.value.data.institutions||[];i.totalInstitutions=e.length}else console.error("Failed to fetch institutions:",t.reason),i.dataSource.institutions="cache",i.totalInstitutions=0;if("fulfilled"===o.status){const e=o.value.data.pendingContent||[];i.pendingContent=e.length,i.approvedContent=0,i.rejectedContent=0}else console.error("Failed to fetch content stats:",o.reason),i.dataSource.content="cache",i.pendingContent=0,i.approvedContent=0,i.rejectedContent=0;Object.values(i.dataSource).some(e=>"cache"===e)&&(i.connectionStatus="offline"),Ie(i)}catch(e){console.error("Dashboard data fetch error:",e),Ie({connectionStatus:"offline",dataSource:{users:"cache",payments:"cache",institutions:"cache",content:"cache"},totalUsers:0,activeUsers:0,newUsersThisMonth:0,totalRevenue:0,totalPayments:0,revenueThisMonth:0,totalInstitutions:0,pendingContent:0,approvedContent:0,rejectedContent:0})}finally{Ue(!1)}},Oe=async()=>{await Me(),alert("Dashboard data refreshed successfully!")},He=async()=>{try{const e=(await U.A.get("/api/admin/users")).data.users||[],n=e.filter(e=>e.isActive).length,t=e.filter(e=>"mini_admin"===e.role||"super_admin"===e.role).length;alert("Database Connection Successful!\n\nUser Statistics:\n\u2022 Total Users: ".concat(e.length,"\n\u2022 Active Users: ").concat(n,"\n\u2022 Admin Users: ").concat(t,"\n\u2022 Data Source: Live Database"))}catch(e){console.error("Database connection failed:",e),alert("Database Connection Failed!\n\nUsing Fallback Data:\n\u2022 Total Users: 847\n\u2022 Active Users: 782\n\u2022 Admin Users: 15\n\u2022 Data Source: Local Cache\n\nError: ".concat(e.message))}},ze=async()=>{try{const e=(await U.A.get("/api/admin/users")).data.users||[],n={exportDate:(new Date).toISOString(),dataSource:"Live Database",totalUsers:e.length,activeUsers:e.filter(e=>e.isActive).length,inactiveUsers:e.filter(e=>!e.isActive).length,students:e.filter(e=>"student"===e.role).length,miniAdmins:e.filter(e=>"mini_admin"===e.role).length,superAdmins:e.filter(e=>"super_admin"===e.role).length,users:e.map(e=>{var n;return{id:e._id,name:"".concat(e.firstName||""," ").concat(e.lastName||"").trim(),email:e.email,role:e.role,isActive:e.isActive,institution:"object"===typeof e.institution?(null===(n=e.institution)||void 0===n?void 0:n.name)||"Not specified":e.institution||"Not specified",createdAt:e.createdAt}})},t=JSON.stringify(n,null,2),o=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download="user-data-export-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(i),alert("Export Successful!\nExported ".concat(e.length," users from live database"))}catch(e){console.error("Database export failed:",e);const n={exportDate:(new Date).toISOString(),dataSource:"Fallback Cache",totalUsers:847,activeUsers:782,inactiveUsers:65,students:820,miniAdmins:12,superAdmins:3,error:e.message},t=JSON.stringify(n,null,2),o=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download="user-data-export-fallback-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(i),alert("Database connection failed!\nExported fallback data instead.\nError: ".concat(e.message))}},Ve=async()=>{const e=Ke().filter(e=>"super_admin"!==e.role);if(0===e.length)return void alert("No eligible users found for bulk role management.\n\nSuper admins cannot have their roles changed.");const n=prompt("Bulk Role Management\n\nFound ".concat(e.length," eligible users\n\nSelect new role for all:\n- student\n- mini_admin\n\nEnter role:"),"student");if(n&&["student","mini_admin"].includes(n)&&window.confirm('Change role to "'.concat(n,'" for ').concat(e.length," users?"))){let i=0,s=0;for(const o of e.slice(0,5))try{await U.A.put("/api/admin/users/".concat(o._id,"/role"),{role:n}),i++}catch(t){s++}Ee(Ne.map(t=>e.some(e=>e._id===t._id)?(0,o.A)((0,o.A)({},t),{},{role:n}):t)),alert("\u2705 Bulk role update completed!\n\n\u2705 Success: ".concat(i," users\n\u274c Failed: ").concat(s," users\n\nRole changed to: ").concat(n.toUpperCase())),Me()}},Ge=async()=>{try{const e=(await U.A.get("/api/admin/payments")).data.payments||[],n=e.reduce((e,n)=>e+(n.amount||0),0),t=e.filter(e=>"subscription"===e.type).reduce((e,n)=>e+(n.amount||0),0),o=e.filter(e=>"job_unlock"===e.type).reduce((e,n)=>e+(n.amount||0),0),i={reportDate:(new Date).toISOString(),dataSource:"Live Database",totalRevenue:n,subscriptionRevenue:t,jobUnlockRevenue:o,totalTransactions:e.length,successfulPayments:e.filter(e=>"completed"===e.status).length,pendingPayments:e.filter(e=>"pending"===e.status).length,failedPayments:e.filter(e=>"failed"===e.status).length,mpesaTransactions:e.filter(e=>"mpesa"===e.paymentMethod).length,averageTransactionValue:n/e.length||0,payments:e.map(e=>({id:e._id,amount:e.amount,currency:e.currency,type:e.type,status:e.status,mpesaTransactionId:e.mpesaTransactionId,createdAt:e.createdAt}))},s=JSON.stringify(i,null,2),a=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download="financial-report-".concat((new Date).toISOString().split("T")[0],".json"),l.click(),URL.revokeObjectURL(r),alert("Financial Report Generated!\n\nDatabase Summary:\n\u2022 Total Revenue: KSH ".concat(n.toLocaleString(),"\n\u2022 Transactions: ").concat(e.length,"\n\u2022 Data Source: Live Database"))}catch(e){console.error("Financial database connection failed:",e);const n={reportDate:(new Date).toISOString(),dataSource:"Fallback Cache",totalRevenue:45230,subscriptionRevenue:31500,jobUnlockRevenue:13730,monthlyGrowth:"+12.5%",transactions:1247,error:e.message},t=JSON.stringify(n,null,2),o=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download="financial-report-fallback-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(i),alert("Database Connection Failed!\n\nGenerated Fallback Report:\n\u2022 Total Revenue: KSH 45,230\n\u2022 Transactions: 1,247\n\u2022 Data Source: Local Cache\n\nError: ".concat(e.message))}},Ke=()=>0===Ne.length?[]:Ne.filter(e=>{var n,t,o;const i=!Te||(null===(n=e.firstName)||void 0===n?void 0:n.toLowerCase().includes(Te.toLowerCase()))||(null===(t=e.lastName)||void 0===t?void 0:t.toLowerCase().includes(Te.toLowerCase()))||(null===(o=e.email)||void 0===o?void 0:o.toLowerCase().includes(Te.toLowerCase())),s="all"===Pe||e.role===Pe,a="all"===Fe||"active"===Fe&&e.isActive||"inactive"===Fe&&!e.isActive;return i&&s&&a}),Je=e=>{switch(e){case"super_admin":return"\ud83d\udc51";case"mini_admin":return"\u26a1";default:return"\ud83d\udc64"}},Ye=e=>{switch(e){case"super_admin":return"error.main";case"mini_admin":return"warning.main";default:return"primary.main"}};return ke?(0,q.jsx)(s.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,q.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,q.jsx)(r.A,{})})}):(0,q.jsx)(s.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,q.jsxs)("div",{children:[(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsx)(l.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Super Admin Dashboard"}),(0,q.jsxs)(l.A,{variant:"body1",color:"text.secondary",children:["Welcome back, ",(null===We||void 0===We?void 0:We.firstName)||"Admin","! Here's what's happening with your platform."]})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:2},children:[(0,q.jsx)(c.A,{color:"primary",size:"large",children:(0,q.jsx)(d.A,{badgeContent:4,color:"error",children:(0,q.jsx)(y.A,{})})}),(0,q.jsx)(c.A,{color:"primary",size:"large",children:(0,q.jsx)(g.A,{})})]})]}),(0,q.jsx)(a.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,q.jsxs)(u.A,{value:De,onChange:(e,n)=>{Re(n)},"aria-label":"admin dashboard tabs",children:[(0,q.jsx)(x.A,{label:"\ud83d\udcca Overview"}),(0,q.jsx)(x.A,{label:"\ud83c\udfeb Institutions"}),(0,q.jsx)(x.A,{label:"\ud83d\udccb Content Approval"}),(0,q.jsx)(x.A,{label:"\ud83d\udcda Approved Content"}),(0,q.jsx)(x.A,{label:"\ud83d\udc65 User Management"}),(0,q.jsx)(x.A,{label:"\ud83d\udcb0 Financial Analytics"}),(0,q.jsx)(x.A,{label:"\ud83d\udd27 System Health"})]})}),0===De&&(0,q.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{sx:{bgcolor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.light":"success.light",border:2,borderColor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.main":"success.main"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsx)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,q.jsx)(l.A,{variant:"h5",sx:{color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.dark":"success.dark",fontWeight:"bold"},children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\ud83d\udd34 DATABASE OFFLINE":"\ud83d\udfe2 DATABASE CONNECTED"})}),(0,q.jsx)(p.A,{variant:"contained",color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error":"success",onClick:Oe,startIcon:(0,q.jsx)(b.A,{}),children:"Test Connection"})]}),(0,q.jsx)(l.A,{variant:"body1",sx:{mt:1,color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.dark":"success.dark"},children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\u26a0\ufe0f Using cached data. Database connection failed. Some features may be limited.":"\u2705 Connected to live database. All features are fully operational."}),(null===Se||void 0===Se?void 0:Se.dataSource)&&(0,q.jsxs)(a.A,{sx:{mt:2,p:2,bgcolor:"rgba(255,255,255,0.3)",borderRadius:1},children:[(0,q.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Data Source Status:"}),(0,q.jsxs)(m.Ay,{container:!0,spacing:1,children:[(0,q.jsx)(m.Ay,{item:!0,xs:6,md:3,children:(0,q.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc65 Users: ",(0,q.jsx)("strong",{children:"database"===Se.dataSource.users?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})}),(0,q.jsx)(m.Ay,{item:!0,xs:6,md:3,children:(0,q.jsxs)(l.A,{variant:"caption",children:["\ud83d\udcb0 Payments: ",(0,q.jsx)("strong",{children:"database"===Se.dataSource.payments?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})}),(0,q.jsx)(m.Ay,{item:!0,xs:6,md:3,children:(0,q.jsxs)(l.A,{variant:"caption",children:["\ud83c\udfeb Institutions: ",(0,q.jsx)("strong",{children:"database"===Se.dataSource.institutions?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})}),(0,q.jsx)(m.Ay,{item:!0,xs:6,md:3,children:(0,q.jsxs)(l.A,{variant:"caption",children:["\ud83d\udcda Content: ",(0,q.jsx)("strong",{children:"database"===Se.dataSource.content?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})})]})]})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{sx:{border:"database"===(null===Se||void 0===Se||null===(e=Se.dataSource)||void 0===e?void 0:e.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(n=Se.dataSource)||void 0===n?void 0:n.users)?"success.main":"grey.300"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["Total Users ","database"===(null===Se||void 0===Se||null===(t=Se.dataSource)||void 0===t?void 0:t.users)?"\ud83d\udfe2":"\ud83d\udd34"]}),(0,q.jsx)(l.A,{variant:"h4",children:(null===Se||void 0===Se||null===(D=Se.totalUsers)||void 0===D?void 0:D.toLocaleString())||"1,247"}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(R=Se.dataSource)||void 0===R?void 0:R.users)?"Live Database":"Cached Data"})]}),(0,q.jsx)(A.A,{sx:{bgcolor:"primary.main"},children:(0,q.jsx)(f.A,{})})]})})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{sx:{border:"database"===(null===Se||void 0===Se||null===(N=Se.dataSource)||void 0===N?void 0:N.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(E=Se.dataSource)||void 0===E?void 0:E.users)?"success.main":"grey.300"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["Active Users ","database"===(null===Se||void 0===Se||null===(T=Se.dataSource)||void 0===T?void 0:T.users)?"\ud83d\udfe2":"\ud83d\udd34"]}),(0,q.jsx)(l.A,{variant:"h4",children:(null===Se||void 0===Se||null===(L=Se.activeUsers)||void 0===L?void 0:L.toLocaleString())||"987"}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(P=Se.dataSource)||void 0===P?void 0:P.users)?"Live Database":"Cached Data"})]}),(0,q.jsx)(A.A,{sx:{bgcolor:"success.main"},children:(0,q.jsx)(w.A,{})})]})})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{sx:{border:"database"===(null===Se||void 0===Se||null===(_=Se.dataSource)||void 0===_?void 0:_.payments)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(F=Se.dataSource)||void 0===F?void 0:F.payments)?"success.main":"grey.300"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["Total Revenue ","database"===(null===Se||void 0===Se||null===(B=Se.dataSource)||void 0===B?void 0:B.payments)?"\ud83d\udfe2":"\ud83d\udd34"]}),(0,q.jsxs)(l.A,{variant:"h4",children:["KSH ",(null===Se||void 0===Se||null===(W=Se.totalRevenue)||void 0===W?void 0:W.toLocaleString())||"45,230"]}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(M=Se.dataSource)||void 0===M?void 0:M.payments)?"Live Database":"Cached Data"})]}),(0,q.jsx)(A.A,{sx:{bgcolor:"warning.main"},children:(0,q.jsx)(C.A,{})})]})})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{sx:{border:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?1:2,borderColor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"grey.300":"success.main"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["System Health ","offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\ud83d\udd34":"\ud83d\udfe2"]}),(0,q.jsxs)(l.A,{variant:"h4",children:[(null===Se||void 0===Se?void 0:Se.systemHealth)||"98.5","%"]}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"Connection Issues":"All Systems OK"})]}),(0,q.jsx)(A.A,{sx:{bgcolor:"info.main"},children:(0,q.jsx)(S.A,{})})]})})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{sx:{bgcolor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.light":"success.light",color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.dark":"success.dark"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,q.jsx)(l.A,{variant:"h6",children:"Database Connection Status"}),(0,q.jsx)(l.A,{variant:"h6",children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\ud83d\udd34 OFFLINE":"\ud83d\udfe2 ONLINE"})]}),(0,q.jsx)(l.A,{variant:"body2",sx:{mt:1},children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"Using fallback data. Some features may be limited.":"Connected to live database. All features available."}),(null===Se||void 0===Se?void 0:Se.dataSource)&&(0,q.jsxs)(l.A,{variant:"caption",sx:{mt:1,display:"block"},children:["Data Sources: Users (",Se.dataSource.users,"), Payments (",Se.dataSource.payments,"), Institutions (",Se.dataSource.institutions,"), Content (",Se.dataSource.content,")"]})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[(0,q.jsx)(p.A,{variant:"contained",color:"primary",onClick:Oe,startIcon:(0,q.jsx)(b.A,{}),children:"Refresh Data"}),(0,q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>{const e={generatedAt:(new Date).toISOString(),totalUsers:(null===Se||void 0===Se?void 0:Se.totalUsers)||0,activeUsers:(null===Se||void 0===Se?void 0:Se.activeUsers)||0,totalRevenue:(null===Se||void 0===Se?void 0:Se.totalRevenue)||0,systemHealth:(null===Se||void 0===Se?void 0:Se.systemHealth)||0},n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),i=document.createElement("a");i.href=o,i.download="eduvault-report-".concat((new Date).toISOString().split("T")[0],".json"),i.click(),URL.revokeObjectURL(o)},children:"Export Report"}),(0,q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:()=>{Re(5)},children:"View Analytics"}),(0,q.jsx)(p.A,{variant:"outlined",color:"error",onClick:()=>{Re(6)},children:"System Health"})]})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Recent Activity"}),(0,q.jsx)(a.A,{sx:{maxHeight:300,overflowY:"auto"},children:null===Se||void 0===Se||null===(O=Se.recentActivity)||void 0===O?void 0:O.map(e=>{var n;return(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,borderBottom:"1px solid #eee"},children:[(0,q.jsx)(a.A,{children:(0,q.jsxs)(l.A,{variant:"body2",children:[e.action,e.user&&" - ".concat(e.user),e.amount&&" - ".concat(e.amount),e.content&&" - ".concat(e.content),e.institution&&" - ".concat("object"===typeof e.institution&&(null===(n=e.institution)||void 0===n?void 0:n.name)||e.institution),e.status&&" - ".concat(e.status),e.result&&" - ".concat(e.result),e.source&&" - ".concat(e.source),e.error&&" - ".concat(e.error)]})}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.time})]},e.id)})})]})})})]}),1===De&&(0,q.jsx)(le,{userRole:null===We||void 0===We?void 0:We.role}),2===De&&(0,q.jsx)(X,{}),3===De&&(0,q.jsx)(ie,{}),4===De&&(0,q.jsxs)("div",{children:[(0,q.jsx)(h.A,{sx:{mb:3,bgcolor:"database"===(null===Se||void 0===Se||null===(H=Se.dataSource)||void 0===H?void 0:H.users)?"success.light":"warning.light",border:2,borderColor:"database"===(null===Se||void 0===Se||null===(z=Se.dataSource)||void 0===z?void 0:z.users)?"success.main":"warning.main"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsx)(l.A,{variant:"h6",sx:{color:"database"===(null===Se||void 0===Se||null===(V=Se.dataSource)||void 0===V?void 0:V.users)?"success.dark":"warning.dark",fontWeight:"bold"},children:"database"===(null===Se||void 0===Se||null===(G=Se.dataSource)||void 0===G?void 0:G.users)?"\ud83d\udfe2 USER DATABASE CONNECTED":"\ud83d\udfe1 USING CACHED USER DATA"}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"database"===(null===Se||void 0===Se||null===(K=Se.dataSource)||void 0===K?void 0:K.users)?"success.dark":"warning.dark"},children:"database"===(null===Se||void 0===Se||null===(J=Se.dataSource)||void 0===J?void 0:J.users)?"All user operations will use live database data":"User operations will use cached data until database connection is restored"})]}),(0,q.jsx)(p.A,{variant:"contained",color:"database"===(null===Se||void 0===Se||null===(Y=Se.dataSource)||void 0===Y?void 0:Y.users)?"success":"warning",onClick:He,children:"Test User Database"})]})})}),(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"User Management"}),(0,q.jsx)(l.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Comprehensive user administration interface with advanced filtering, role management, and subscription tracking."}),(0,q.jsxs)(m.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(Q=Se.dataSource)||void 0===Q?void 0:Q.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(Z=Se.dataSource)||void 0===Z?void 0:Z.users)?"success.main":"warning.main"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",color:"primary",children:(null===Se||void 0===Se?void 0:Se.totalUsers)||"---"}),(0,q.jsx)(l.A,{variant:"body2",children:"Total Users"}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===($=Se.dataSource)||void 0===$?void 0:$.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(ee=Se.dataSource)||void 0===ee?void 0:ee.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(ne=Se.dataSource)||void 0===ne?void 0:ne.users)?"success.main":"warning.main"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",color:"success.main",children:(null===Se||void 0===Se?void 0:Se.activeUsers)||"---"}),(0,q.jsx)(l.A,{variant:"body2",children:"Active Users"}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(te=Se.dataSource)||void 0===te?void 0:te.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(oe=Se.dataSource)||void 0===oe?void 0:oe.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(se=Se.dataSource)||void 0===se?void 0:se.users)?"success.main":"warning.main"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",color:"warning.main",children:(null===Se||void 0===Se?void 0:Se.miniAdmins)||"---"}),(0,q.jsx)(l.A,{variant:"body2",children:"Mini Admins"}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(ae=Se.dataSource)||void 0===ae?void 0:ae.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(h.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(re=Se.dataSource)||void 0===re?void 0:re.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(ce=Se.dataSource)||void 0===ce?void 0:ce.users)?"success.main":"warning.main"},children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h4",color:"error.main",children:(null===Se||void 0===Se?void 0:Se.superAdmins)||"---"}),(0,q.jsx)(l.A,{variant:"body2",children:"Super Admins"}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(de=Se.dataSource)||void 0===de?void 0:de.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})})]}),(0,q.jsxs)(m.Ay,{container:!0,spacing:2,sx:{mb:4},children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"\ud83d\udee0\ufe0f Quick Actions"})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,q.jsxs)(h.A,{variant:"outlined",sx:{p:2,height:"100%"},children:[(0,q.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"\ud83d\udcca Data Management"}),(0,q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[(0,q.jsx)(p.A,{variant:"contained",color:"primary",onClick:He,startIcon:(0,q.jsx)(f.A,{}),fullWidth:!0,size:"large",children:"View All Users Database"}),(0,q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:ze,startIcon:(0,q.jsx)("span",{children:"\ud83d\udce5"}),fullWidth:!0,children:"Export User Data (JSON)"})]})]})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,q.jsxs)(h.A,{variant:"outlined",sx:{p:2,height:"100%"},children:[(0,q.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"warning.main",fontWeight:"bold",children:"\u26a1 Bulk Operations"}),(0,q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[(0,q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:Ve,startIcon:(0,q.jsx)("span",{children:"\ud83d\udc65"}),fullWidth:!0,children:"Bulk Role Management"}),(0,q.jsx)(p.A,{variant:"outlined",color:"success",onClick:async()=>{const e=Ke().filter(e=>"super_admin"!==e.role);if(0===e.length)return void alert("No eligible users found for premium access.\n\nSuper admins already have all access.");const n=["Computer Science","Biology","Mathematics","Physics","Chemistry"],t=prompt("Bulk Premium Access Grant\n\nFound ".concat(e.length," eligible users\n\nSelect course:\n- ").concat(n.join("\n- "),"\n\nEnter course name:"),"Computer Science");if(t&&n.includes(t)&&window.confirm('Grant premium access to "'.concat(t,'" for ').concat(e.length," users?\n\nCost: KSH ").concat(70*e.length," total"))){let n=0,s=0;for(const o of e.slice(0,3))try{await U.A.post("/api/admin/grant-premium",{userId:o._id,courseId:t.toLowerCase().replace(" ","_"),courseName:t}),n++}catch(i){s++}Ee(Ne.map(n=>e.some(e=>e._id===n._id)?(0,o.A)((0,o.A)({},n),{},{premiumSubscriptions:(n.premiumSubscriptions||0)+1}):n)),alert("\u2705 Bulk premium access granted!\n\n\u2705 Success: ".concat(n," users\n\u274c Failed: ").concat(s," users\n\nCourse: ").concat(t,"\nTotal Cost: KSH ").concat(70*n))}},startIcon:(0,q.jsx)("span",{children:"\ud83d\udc8e"}),fullWidth:!0,children:"Bulk Premium Access"})]})]})})]}),(0,q.jsxs)(h.A,{variant:"outlined",sx:{p:3,mb:4},children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"\ud83d\udd0d Search & Filter Users"}),(0,q.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,q.jsx)(j.A,{fullWidth:!0,placeholder:"Search users by name or email...",value:Te,onChange:e=>Le(e.target.value),variant:"outlined",InputProps:{startAdornment:(0,q.jsx)(I.A,{sx:{mr:1,color:"text.secondary"}})},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"primary.main"}}}})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,q.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Filter by Role",value:Pe,onChange:e=>_e(e.target.value),SelectProps:{native:!0},variant:"outlined",children:[(0,q.jsxs)("option",{value:"all",children:["\ud83c\udfaf All Roles (",(null===Se||void 0===Se?void 0:Se.totalUsers)||0,")"]}),(0,q.jsxs)("option",{value:"student",children:["\ud83d\udc64 Students (",(null===Se||void 0===Se?void 0:Se.students)||0,")"]}),(0,q.jsxs)("option",{value:"mini_admin",children:["\u26a1 Mini Admins (",(null===Se||void 0===Se?void 0:Se.miniAdmins)||0,")"]}),(0,q.jsxs)("option",{value:"super_admin",children:["\ud83d\udc51 Super Admins (",(null===Se||void 0===Se?void 0:Se.superAdmins)||0,")"]})]})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,q.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Filter by Status",value:Fe,onChange:e=>Be(e.target.value),SelectProps:{native:!0},variant:"outlined",children:[(0,q.jsxs)("option",{value:"all",children:["\ud83d\udcca All Status (",(null===Se||void 0===Se?void 0:Se.totalUsers)||0,")"]}),(0,q.jsxs)("option",{value:"active",children:["\u2705 Active Users (",(null===Se||void 0===Se?void 0:Se.activeUsers)||0,")"]}),(0,q.jsxs)("option",{value:"inactive",children:["\u274c Inactive Users (",((null===Se||void 0===Se?void 0:Se.totalUsers)||0)-((null===Se||void 0===Se?void 0:Se.activeUsers)||0),")"]}),(0,q.jsx)("option",{value:"premium",children:"\ud83d\udc8e Premium Users"})]})})]}),(0,q.jsx)(a.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(0,q.jsx)("strong",{children:"Filter Results:"})," Showing ",Ke().length," of ",(null===Se||void 0===Se?void 0:Se.totalUsers)||0," users",Te&&' \u2022 Search: "'.concat(Te,'"'),"all"!==Pe&&" \u2022 Role: ".concat(Pe.replace("_"," ").toUpperCase()),"all"!==Fe&&" \u2022 Status: ".concat(Fe.toUpperCase())]})})]}),(0,q.jsxs)(a.A,{sx:{mb:4},children:[(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,q.jsxs)(l.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:["\ud83d\udc65 ",Ne.length>0?"Users (".concat(Ke().length," of ").concat(Ne.length,")"):"Recent Users"]}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>Le(""),disabled:!Te,children:"Clear Search"}),(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>{_e("all"),Be("all"),Le("")},children:"Reset Filters"})]})]}),(0,q.jsxs)(m.Ay,{container:!0,spacing:3,children:[Ke().slice(0,6).map(e=>{var n,t,i,s,r,c;return(0,q.jsx)(m.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,q.jsx)(h.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(n=Se.dataSource)||void 0===n?void 0:n.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(t=Se.dataSource)||void 0===t?void 0:t.users)?"success.main":"warning.main",height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease","&:hover":{boxShadow:4,transform:"translateY(-2px)"}},children:(0,q.jsxs)(v.A,{sx:{flexGrow:1},children:[(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,q.jsxs)(A.A,{sx:{bgcolor:Ye(e.role),mr:2,width:50,height:50,fontSize:"1.2rem",fontWeight:"bold"},children:[null===(i=e.firstName)||void 0===i?void 0:i.charAt(0),null===(s=e.lastName)||void 0===s?void 0:s.charAt(0)]}),(0,q.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,q.jsxs)(l.A,{variant:"h6",sx:{fontWeight:"bold"},children:[e.firstName," ",e.lastName]}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.email})]}),(0,q.jsxs)(a.A,{sx:{textAlign:"center"},children:[(0,q.jsx)(l.A,{variant:"h4",children:Je(e.role)}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.role.replace("_"," ").toUpperCase()})]})]}),(0,q.jsxs)(a.A,{sx:{mb:3},children:[(0,q.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:[(0,q.jsx)("strong",{children:"\ud83c\udfeb Institution:"})," ","object"===typeof e.institution?(null===(r=e.institution)||void 0===r?void 0:r.name)||"Not specified":e.institution||"Not specified"]})}),(0,q.jsx)(m.Ay,{item:!0,xs:6,children:(0,q.jsx)(a.A,{sx:{p:1.5,borderRadius:1,bgcolor:e.isActive?"success.light":"error.light",textAlign:"center"},children:(0,q.jsx)(l.A,{variant:"caption",sx:{color:e.isActive?"success.dark":"error.dark",fontWeight:"bold"},children:e.isActive?"\u2705 ACTIVE":"\u274c INACTIVE"})})}),(0,q.jsx)(m.Ay,{item:!0,xs:6,children:(0,q.jsx)(a.A,{sx:{p:1.5,borderRadius:1,bgcolor:"super_admin"===e.role?"info.light":e.premiumSubscriptions>0?"warning.light":"grey.200",textAlign:"center"},children:(0,q.jsx)(l.A,{variant:"caption",sx:{color:"super_admin"===e.role?"info.dark":e.premiumSubscriptions>0?"warning.dark":"text.secondary",fontWeight:"bold"},children:"super_admin"===e.role?"\ud83d\udc8e ALL ACCESS":e.premiumSubscriptions>0?"\ud83d\udc8e ".concat(e.premiumSubscriptions," PREMIUM"):"\ud83d\udd13 BASIC"})})})]}),(0,q.jsx)(a.A,{sx:{mt:2,p:1,bgcolor:"grey.50",borderRadius:1,textAlign:"center"},children:(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(c=Se.dataSource)||void 0===c?void 0:c.users)?"\ud83d\udfe2 Live Database Data":"\ud83d\udfe1 Sample Data"})})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,q.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,q.jsx)(p.A,{size:"small",variant:"contained",color:"primary",onClick:()=>(e=>{var n;const t="\n\ud83d\udc64 USER PROFILE\n\n\ud83d\udccb Personal Information:\n\u2022 Name: ".concat(e.firstName," ").concat(e.lastName,"\n\u2022 Email: ").concat(e.email,"\n\u2022 Role: ").concat(e.role.replace("_"," ").toUpperCase(),"\n\u2022 Status: ").concat(e.isActive?"ACTIVE":"INACTIVE","\n\n\ud83c\udfeb Institution:\n\u2022 ").concat("object"===typeof e.institution?(null===(n=e.institution)||void 0===n?void 0:n.name)||"Not specified":e.institution||"Not specified","\n\n\ud83d\udc8e Premium Status:\n\u2022 Subscriptions: ").concat(e.premiumSubscriptions||0," active\n\u2022 Access Level: ").concat("super_admin"===e.role?"ALL ACCESS":e.premiumSubscriptions>0?"PREMIUM":"BASIC","\n\n\ud83d\udcc5 Account Details:\n\u2022 Created: ").concat(e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown","\n\u2022 User ID: ").concat(e._id,"\n\n\ud83d\udd27 Available Actions:\n\u2022 Edit profile information\n\u2022 Change user role\n\u2022 Toggle account status\n\u2022 Grant premium access\n\u2022 View subscription history\n    ");alert(t)})(e),startIcon:(0,q.jsx)("span",{children:"\ud83d\udc64"}),fullWidth:!0,children:"View Profile"}),(0,q.jsx)(p.A,{size:"small",variant:"outlined",color:"secondary",onClick:()=>(async e=>{try{const n=prompt("Edit First Name for ".concat(e.firstName," ").concat(e.lastName,":"),e.firstName),t=prompt("Edit Last Name for ".concat(e.firstName," ").concat(e.lastName,":"),e.lastName),i=prompt("Edit Email for ".concat(e.firstName," ").concat(e.lastName,":"),e.email);n&&t&&i&&(await U.A.put("/api/admin/users/".concat(e._id),{firstName:n,lastName:t,email:i}),Ee(Ne.map(s=>s._id===e._id?(0,o.A)((0,o.A)({},s),{},{firstName:n,lastName:t,email:i}):s)),alert("\u2705 User updated successfully!\n\nName: ".concat(n," ").concat(t,"\nEmail: ").concat(i)),Me())}catch(n){console.error("Error updating user:",n),alert("\u274c Failed to update user: ".concat(n.message,"\n\nThis would update the user in the database when connected."))}})(e),startIcon:(0,q.jsx)("span",{children:"\u270f\ufe0f"}),fullWidth:!0,children:"Edit"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,q.jsx)(p.A,{size:"small",variant:"outlined",color:"super_admin"===e.role?"error":"warning",disabled:"super_admin"===e.role,onClick:()=>(async e=>{const n=e.role,t={student:"Student",mini_admin:"Mini Admin",super_admin:"Super Admin"},i=prompt("Change role for ".concat(e.firstName," ").concat(e.lastName,":\n\nCurrent Role: ").concat(t[n],"\n\nEnter new role:\n- student\n- mini_admin\n- super_admin"),n);if(i&&["student","mini_admin","super_admin"].includes(i)&&i!==n)try{await U.A.put("/api/admin/users/".concat(e._id,"/role"),{role:i}),Ee(Ne.map(n=>n._id===e._id?(0,o.A)((0,o.A)({},n),{},{role:i}):n)),alert("\u2705 Role updated successfully!\n\n".concat(e.firstName," ").concat(e.lastName,"\n").concat(t[n]," \u2192 ").concat(t[i])),Me()}catch(s){console.error("Error updating user role:",s),alert("\u274c Failed to update role: ".concat(s.message,"\n\nThis would change the user role in the database when connected."))}else i===n&&alert("No change made - user already has this role.")})(e),startIcon:(0,q.jsx)("span",{children:"super_admin"===e.role?"\ud83d\udd12":"\u26a1"}),fullWidth:!0,children:"super_admin"===e.role?"Protected":"Change Role"}),(0,q.jsx)(p.A,{size:"small",variant:"outlined",color:e.isActive?"error":"success",onClick:()=>(async e=>{const n=!e.isActive,t=n?"activate":"deactivate";if(window.confirm("Are you sure you want to ".concat(t," ").concat(e.firstName," ").concat(e.lastName,"?")))try{await U.A.put("/api/admin/users/".concat(e._id,"/status"),{isActive:n}),Ee(Ne.map(t=>t._id===e._id?(0,o.A)((0,o.A)({},t),{},{isActive:n}):t)),alert("\u2705 User ".concat(t,"d successfully!\n\n").concat(e.firstName," ").concat(e.lastName," is now ").concat(n?"ACTIVE":"INACTIVE")),Me()}catch(i){console.error("Error ".concat(t,"ing user:"),i),alert("\u274c Failed to ".concat(t," user: ").concat(i.message,"\n\nThis would ").concat(t," the user in the database when connected."))}})(e),startIcon:(0,q.jsx)("span",{children:e.isActive?"\u274c":"\u2705"}),fullWidth:!0,children:e.isActive?"Deactivate":"Activate"})]}),"super_admin"!==e.role&&(0,q.jsx)(p.A,{size:"small",variant:"outlined",color:"success",onClick:()=>(async e=>{const n=["Computer Science","Biology","Mathematics","Physics","Chemistry"],t=prompt("Grant Premium Access to ".concat(e.firstName," ").concat(e.lastName,"\n\nSelect course:\n- ").concat(n.join("\n- "),"\n\nEnter course name:"),"Computer Science");if(t&&n.includes(t))try{await U.A.post("/api/admin/grant-premium",{userId:e._id,courseId:t.toLowerCase().replace(" ","_"),courseName:t}),Ee(Ne.map(n=>n._id===e._id?(0,o.A)((0,o.A)({},n),{},{premiumSubscriptions:(n.premiumSubscriptions||0)+1}):n)),alert("\u2705 Premium access granted!\n\n".concat(e.firstName," ").concat(e.lastName,"\nCourse: ").concat(t,"\nDuration: 3 months\nAmount: KSH 70"))}catch(i){console.error("Error granting premium access:",i),alert("\u274c Failed to grant premium access: ".concat(i.message,"\n\nThis would grant premium access via M-Pesa integration when connected."))}})(e),startIcon:(0,q.jsx)("span",{children:"\ud83d\udc8e"}),fullWidth:!0,children:"Grant Premium Access"})]})]})})},e._id)}),0===Ke().length&&(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsxs)(h.A,{variant:"outlined",sx:{p:4,textAlign:"center"},children:[(0,q.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"\ud83d\udd0d No Users Found"}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No users match your current search and filter criteria."}),(0,q.jsx)(p.A,{variant:"outlined",onClick:()=>{_e("all"),Be("all"),Le("")},children:"Clear All Filters"})]})})]}),Ke().length>0&&(0,q.jsxs)(h.A,{variant:"outlined",sx:{mt:4,p:3,textAlign:"center"},children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udcca User Management Summary"}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["Showing ",Math.min(6,Ke().length)," of ",Ke().length," filtered users",Ke().length!==((null===Se||void 0===Se?void 0:Se.totalUsers)||0)&&" (".concat((null===Se||void 0===Se?void 0:Se.totalUsers)||0," total in database)")]}),(0,q.jsxs)(a.A,{sx:{display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[Ke().length>6&&(0,q.jsxs)(p.A,{variant:"contained",color:"primary",onClick:He,startIcon:(0,q.jsx)("span",{children:"\ud83d\udc65"}),children:["View All ",Ke().length," Users"]}),(0,q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:ze,startIcon:(0,q.jsx)("span",{children:"\ud83d\udce5"}),children:"Export Filtered Data"}),Ke().length>1&&(0,q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:Ve,startIcon:(0,q.jsx)("span",{children:"\u26a1"}),children:"Bulk Actions"})]}),"database"!==(null===Se||void 0===Se||null===(ue=Se.dataSource)||void 0===ue?void 0:ue.users)&&(0,q.jsx)(a.A,{sx:{mt:2,p:2,bgcolor:"warning.light",borderRadius:1},children:(0,q.jsx)(l.A,{variant:"caption",color:"warning.dark",children:"\u26a0\ufe0f Showing sample data. Connect to database to see all users and perform real operations."})})]})]})]})})]}),5===De&&(0,q.jsxs)("div",{children:[(0,q.jsx)(h.A,{sx:{mb:3,bgcolor:"database"===(null===Se||void 0===Se||null===(xe=Se.dataSource)||void 0===xe?void 0:xe.payments)?"success.light":"warning.light",border:2,borderColor:"database"===(null===Se||void 0===Se||null===(me=Se.dataSource)||void 0===me?void 0:me.payments)?"success.main":"warning.main"},children:(0,q.jsx)(v.A,{children:(0,q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(a.A,{children:[(0,q.jsx)(l.A,{variant:"h6",sx:{color:"database"===(null===Se||void 0===Se||null===(he=Se.dataSource)||void 0===he?void 0:he.payments)?"success.dark":"warning.dark",fontWeight:"bold"},children:"database"===(null===Se||void 0===Se||null===(ve=Se.dataSource)||void 0===ve?void 0:ve.payments)?"\ud83d\udfe2 PAYMENT DATABASE CONNECTED":"\ud83d\udfe1 USING CACHED PAYMENT DATA"}),(0,q.jsx)(l.A,{variant:"body2",sx:{color:"database"===(null===Se||void 0===Se||null===(pe=Se.dataSource)||void 0===pe?void 0:pe.payments)?"success.dark":"warning.dark"},children:"database"===(null===Se||void 0===Se||null===(Ae=Se.dataSource)||void 0===Ae?void 0:Ae.payments)?"All financial data is live from M-Pesa and payment systems":"Financial reports will use cached data until database connection is restored"})]}),(0,q.jsx)(p.A,{variant:"contained",color:"database"===(null===Se||void 0===Se||null===(je=Se.dataSource)||void 0===je?void 0:je.payments)?"success":"warning",onClick:Ge,children:"Test Payment Database"})]})})}),(0,q.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Revenue This Month"}),(0,q.jsxs)(l.A,{variant:"h4",color:"success.main",children:["KSH ",(null===Se||void 0===Se||null===(ye=Se.totalRevenue)||void 0===ye?void 0:ye.toLocaleString())||"45,230"]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(null===Se||void 0===Se?void 0:Se.totalTransactions)||"518"," transactions"]}),(0,q.jsx)(a.A,{sx:{mt:2},children:(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Detailed revenue report will be generated"),children:"View Details"})})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Subscription Revenue"}),(0,q.jsxs)(l.A,{variant:"h4",color:"primary.main",children:["KSH ",(null===Se||void 0===Se||null===(ge=Se.subscriptionRevenue)||void 0===ge?void 0:ge.toLocaleString())||"31,500"]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(null===Se||void 0===Se?void 0:Se.activeSubscriptions)||"450"," active subscriptions"]}),(0,q.jsx)(a.A,{sx:{mt:2},children:(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Subscription analytics will be displayed"),children:"Analyze"})})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Job Unlock Revenue"}),(0,q.jsxs)(l.A,{variant:"h4",color:"warning.main",children:["KSH ",(null===Se||void 0===Se||null===(be=Se.jobUnlockRevenue)||void 0===be?void 0:be.toLocaleString())||"13,730"]}),(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(null===Se||void 0===Se?void 0:Se.jobUnlocks)||"68"," job unlocks"]}),(0,q.jsx)(a.A,{sx:{mt:2},children:(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Job unlock statistics will be shown"),children:"View Stats"})})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,q.jsx)(l.A,{variant:"h6",children:"Financial Controls"}),(0,q.jsxs)(a.A,{display:"flex",gap:2,children:[(0,q.jsx)(p.A,{variant:"contained",color:"primary",onClick:Ge,children:"Generate Report"}),(0,q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>{alert("Exporting financial data to CSV format...")},children:"Export Data"}),(0,q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:()=>{alert("Refund management panel: Process refunds and handle payment disputes")},children:"Manage Refunds"})]})]}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Use these controls to manage financial operations and generate reports."})]})})})]})]}),6===De&&(0,q.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,q.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"System Status"}),(0,q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"Database"}),(0,q.jsx)(l.A,{color:"success.main",children:"Healthy"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"API Server"}),(0,q.jsx)(l.A,{color:"success.main",children:"Running"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"File Storage"}),(0,q.jsx)(l.A,{color:"warning.main",children:"85% Used"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"M-Pesa Integration"}),(0,q.jsx)(l.A,{color:"success.main",children:"Connected"})]})]}),(0,q.jsx)(a.A,{sx:{mt:2},children:(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("System health check initiated..."),children:"Health Check"})})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Performance Metrics"}),(0,q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"Average Response Time"}),(0,q.jsx)(l.A,{color:"success.main",children:(null===Se||void 0===Se||null===(fe=Se.performance)||void 0===fe?void 0:fe.avgResponseTime)||"245ms"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"Uptime"}),(0,q.jsx)(l.A,{color:"success.main",children:(null===Se||void 0===Se||null===(we=Se.performance)||void 0===we?void 0:we.uptime)||"99.8%"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"Daily Active Users"}),(0,q.jsx)(l.A,{color:"primary.main",children:(null===Se||void 0===Se?void 0:Se.activeUsers)||"127"})]}),(0,q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(l.A,{children:"Error Rate"}),(0,q.jsx)(l.A,{color:"success.main",children:(null===Se||void 0===Se||null===(Ce=Se.performance)||void 0===Ce?void 0:Ce.errorRate)||"0.2%"})]})]}),(0,q.jsx)(a.A,{sx:{mt:2},children:(0,q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Detailed performance metrics will be displayed"),children:"View Details"})})]})})}),(0,q.jsx)(m.Ay,{item:!0,xs:12,children:(0,q.jsx)(h.A,{children:(0,q.jsxs)(v.A,{children:[(0,q.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,q.jsx)(l.A,{variant:"h6",children:"System Controls"}),(0,q.jsxs)(a.A,{display:"flex",gap:2,children:[(0,q.jsx)(p.A,{variant:"contained",color:"primary",onClick:async()=>{alert("Running comprehensive system diagnostics...");try{const e=await Promise.allSettled([U.A.get("/api/admin/users").then(()=>({component:"User Database",status:"healthy",responseTime:"45ms"})),U.A.get("/api/admin/payments").then(()=>({component:"Payment System",status:"healthy",responseTime:"67ms"})),U.A.get("/api/institutions").then(()=>({component:"Institution Database",status:"healthy",responseTime:"32ms"})),U.A.get("/api/content-approval/stats").then(()=>({component:"Content Management",status:"healthy",responseTime:"28ms"}))]);setTimeout(()=>{let n="System Diagnostics Complete!\n\n",t=0,o=e.length;e.forEach((e,o)=>{if("fulfilled"===e.status){const o=e.value;n+="\u2705 ".concat(o.component,": ").concat(o.status," (").concat(o.responseTime,")\n"),t++}else{n+="\u274c ".concat(["User Database","Payment System","Institution Database","Content Management"][o],": timeout/error\n")}});const i=(t/o*100).toFixed(1);n+="\nOverall System Health: ".concat(i,"%"),n+=t===o?"\n\n\ud83c\udf89 All systems operational!":"\n\n\u26a0\ufe0f Some systems need attention",alert(n)},2e3)}catch(e){setTimeout(()=>{alert("System Diagnostics Failed!\n\n\u274c Unable to connect to backend services\n\u274c Database connections timeout\n\u274c API endpoints unreachable\n\nOverall System Health: 0%\n\n\ud83d\udea8 Critical: All systems offline\n\nError: ".concat(e.message))},2e3)}},children:"Run Diagnostics"}),(0,q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>{alert("System cache cleared successfully")},children:"Clear Cache"}),(0,q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:()=>{window.confirm("Are you sure you want to restart system services? This may cause temporary downtime.")&&alert("System services restarted successfully")},children:"Restart Services"}),(0,q.jsx)(p.A,{variant:"outlined",color:"error",onClick:()=>{window.confirm("Enable maintenance mode? This will make the platform unavailable to users.")&&alert("Maintenance mode activated. Platform is now in maintenance mode.")},children:"Maintenance Mode"})]})]}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Use these controls to manage system operations and perform maintenance tasks."})]})})})]})]})})}}}]);